{
    "test_cases": {
		"TEST_CASE_1": {
			"description":"Validate column/schema naming convention for RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL When all the columns and data types are matched Then schema naming convention is verified and passed",
			"type": "Schema",
			"sql_query":["SELECT lower(column_name) as column_name ,lower(data_type) as data_type FROM `{project_name}.{dataset_id}`.INFORMATION_SCHEMA.COLUMNS WHERE table_name='RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL'"],
			"top_75":null

		},
   		"TEST_CASE_2": {
			"description":"No duplicate record displaying for each cin-dc,invoice number and supplier for any given invoice date  When searched with invoice date filter  Then each cin-dc,invoice number and supplier combination should have distinct record",
			"type": "RCA",
			"sql_query":["select b.* from (SELECT Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,count(concat(Process_date,'-',Invoice_Date,'-',cin,'-',dc,'-',Invoice_Number,'-',INVOICE_LINE_NUMBER,'-',Inv_Purchasing_Supplier,'-',LF_Ship_To_Location_Num,'-')) count_cin_dc FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' group by Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num having count_cin_dc>1)a inner join (select * from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}')b on a.invoice_date=b.invoice_date and a.process_date=b.process_date and a.CIN=b.cin and a.dc=b.dc and a.invoice_number=b.invoice_number and a.invoice_line_number=b.invoice_line_number  and a.Inv_Purchasing_Supplier=b.Inv_Purchasing_Supplier"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,lf_ship_to_location_num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"

		},
		"TEST_CASE_3": {
			"description":"To verify whether the supplier type is correctly tagged When searched for any process date for any CIN and DC Then CF_Supplier_Type should be correctly tagged as 'CENTRALIZED','NONCENTRALIZED' or 'HUBSPOKE'",
			"type": "RCA",
			"sql_query":["select distinct Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num, CF_Supplier_Type,Inv_Buyer_Work_Field_Number,Inv_Purchasing_Supplier_Sub_Group from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='CENTRALIZED' and process_date='{process_date}' and (((LF_Ship_To_Location_Num=26 or (LF_Ship_To_Location_Num<>26 and Inv_Purchasing_Supplier='90990')) and Inv_Buyer_Work_Field_Number not in ('') and Inv_Purchasing_Supplier_Sub_Group like 'MINHB%') or ((LF_Ship_To_Location_Num=37 or (LF_Ship_To_Location_Num<>37 and Inv_Purchasing_Supplier='90967')) and Inv_Buyer_Work_Field_Number not in ('') and Inv_Purchasing_Supplier_Sub_Group like 'MINHB%')) and Inv_Purchasing_Supplier<>'90163'",
			"select distinct Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,CF_Supplier_Type,Inv_Buyer_Work_Field_Number,Inv_Purchasing_Supplier_Sub_Group from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='HUBSPOKE' and process_date='{process_date}' and not(((LF_Ship_To_Location_Num=26 or (LF_Ship_To_Location_Num<>26 and Inv_Purchasing_Supplier='90990')) or (LF_Ship_To_Location_Num=37 or (LF_Ship_To_Location_Num<>37 and Inv_Purchasing_Supplier='90967'))) and Inv_Purchasing_Supplier<>'90163')",
			"select distinct Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,CF_Supplier_Type,Inv_Buyer_Work_Field_Number,Inv_Purchasing_Supplier_Sub_Group from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='NONCENTRALIZED' and process_date='{process_date}' and (lf_ship_to_location_num in (26,37) or Inv_Purchasing_Supplier in ('90163','90990','90967')) and Inv_Buyer_Work_Field_Number<>''"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select  process_date,invoice_date,cin,dc,lf_ship_to_location_num,Inv_Purchasing_Supplier,cf_supplier_type,Inv_Buyer_Work_Field_Number,Inv_Purchasing_Supplier_Sub_Group FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
		},
		"TEST_CASE_4": {
			"description":"To verify the Availability alert to identify product backlog When searched with process date for any material Then record should always display AA code except 950,995,980",
			"type": "RCA",
			"sql_query":["select Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,lf_aa_code FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' and (LF_AA_Code is null or cast(lf_aa_code as int) in (950,995,980))"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select  process_date,invoice_date,cin,dc,lf_ship_to_location_num,lf_aa_code FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
		},
		"TEST_CASE_5": {
			"description":"To verify whether supplier has limited inventory available to ship to Cardinal in last 30 days When records for both centralised and non-centralised suppliers are searched Then Network Received Quantity should be greater than or equal to 10% and less than or equal to 95% of ((4*Network Forecast) + Network Holdouts + Network Backorder))",
			"type": "RCA",
			"sql_query":["select Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,cf_network_rec_qty,cf_network_forecast_qty, cf_network_backorder_qty,cf_network_holdout_qty,CF_RCA2_Ordered_Qty  from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` WHERE process_date='{process_date}' and ((ifnull(CF_Network_Rec_Qty,0) <= (( (4*ifnull(CF_MIN_MAX_Network_Forecast_Qty,0)) +ifnull(CF_Network_Backorder_Qty,0)+ifnull(CF_Network_Holdout_Qty,0))*10/100) OR ifnull(CF_Network_Rec_Qty,0) >= (( (4*ifnull(CF_MIN_MAX_Network_Forecast_Qty,0)) +ifnull(CF_Network_Backorder_Qty,0)+ifnull(CF_Network_Holdout_Qty,0))*95/100)) AND ifnull(CF_Network_Rec_Qty,0) > (ifnull(CF_RCA2_Ordered_Qty,0)*0.95) )"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select  process_date,invoice_date,cin,dc,lf_ship_to_location_num,CF_Network_Rec_Qty,CF_Network_Forecast_Qty,CF_Network_Backorder_Qty,CF_Network_HoldOUT_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"

		},
		"TEST_CASE_6": {
			"description":"To verify calculation for Network Received Quantity When searched for a particular process date, invoice date and CIN Then for centralised supplier, Network Received Quantity is calculated at CIN level And for non-centralised supplier, Network Received Quantity is calculated at CIN-shipping location level",
			"type": "RCA",
			"sql_query":["select main.*,tc.CF_Network_Rec_Qty,tc.CF_Network_Rec_Qty_Calc,case when ifnull(round(CF_Network_Rec_Qty,2),0)<>ifnull(round(CF_Network_Rec_Qty_calc,2),0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' and (CF_Supplier_Type='CENTRALIZED' and ifnull(lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8') )) main left outer join (select distinct process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,round(sum(ifnull(pdqtyr,0)),2) CF_Network_Rec_Qty_Calc from (select distinct process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,phodat,phpoid,pdldat,pdqtyr from ((select distinct process_date,invoice_date,cin,dc,inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num,Inv_Buyer_Work_Field_Number from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='CENTRALIZED' and ifnull(lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8')  and process_date='{process_date}')a left outer join (select distinct pdldat,phodat,phpoid,pditem,SHIP_TO_LOCATION_NUM,phsply,(RCV_QTY*CONV_QTY)/CONV_ORDER_QTY_TO_BASE PDQTYR from (select c.*,d.pdldat,d.RCV_QTY from (select distinct safe_cast(mtrl_num as int) pditem,safe_cast(trim(PLANT_01,'P') as int) ship_to_location_num,PURCH_ORDER_VENDOR_NUM phsply,cncl_dte pdcdat,EXPCT_DLVRY_DTE pdoed,PURCH_DOC_DTE phodat,safe_cast(PURCH_DOC_NUM as int) PHPOID,LINE_STAT pdlsts,PLANT_01 phclnt,CONV_QTY,CONV_ORDER_QTY_TO_BASE,QTY_RCV,purch_doc_type from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where  ifnull(safe_cast(PURCH_ORDER_VENDOR_NUM as int),0)<>57334 )c inner join  (SELECT  PURCH_DOC_NUM,  MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE,ACTUAL_GOODS_RCPT_DTE pdldat,sum(case when safe_cast(MVMT_TYPE as int)=101 then RCV_QTY when safe_cast(MVMT_TYPE as int)=102 then (-1)*RCV_QTY end) RCV_QTY FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where safe_cast(MVMT_TYPE as int) in (101,102) group by PURCH_DOC_NUM,  MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE,ACTUAL_GOODS_RCPT_DTE)d on c.pditem=safe_cast(d.mtrl_num as int) and c.phpoid=safe_cast(d.purch_doc_num as int) and safe_cast(trim(client_id,'P') as int)=ship_to_location_num) where safe_cast(phsply as int) not between 90000 and 99999 and purch_doc_type in ('ZPNB', 'ZPOB') and PHSPLY <> '57334' and PDLSTS<>'Open' and phclnt not in ('099B','019B','071R','072R','073R','074R','078R','087R','088R','703R','707R','099X') and (ship_to_location_num=99 or (ship_to_location_num<>99 and phsply in ('90163','90990','90967'))))b on a.cin=cast(b.pditem as numeric)  and date_diff(a.invoice_date,b.pdldat,day) between 1 and 30)) group by process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and ifnull(main.Inv_Purchasing_Supplier,'')=ifnull(tc.Inv_Purchasing_Supplier,'') where ifnull(round(CF_Network_Rec_Qty,2),0)<>ifnull(round(CF_Network_Rec_Qty_calc,2),0)",
			"SELECT main.*, CF_po_order_qty , tc.po_order_qty_calc FROM ( SELECT  Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,CF_po_order_qty   FROM    `{project_name}.{dataset_id}.RCA_UNFILL_PRODUCT_UNAVAILABLE_ON_AA_BACKORDER_CDL`   WHERE     CF_Supplier_Type='HUBSPOKE'  AND process_date='{process_date}'  AND NOT((LF_Ship_To_Location_Num=26  OR (LF_Ship_To_Location_Num<>26  AND Inv_Purchasing_Supplier='90990'))  OR (LF_Ship_To_Location_Num=37  OR (LF_Ship_To_Location_Num<>37  AND Inv_Purchasing_Supplier='90967')))     AND (Inv_Buyer_Work_Field_Number<>''   OR Inv_Purchasing_Supplier_Sub_Group LIKE 'MINHB%') ) main LEFT OUTER JOIN ( SELECT  DISTINCT process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,ROUND(IFNULL(Sum_po_order_qty,0),2) AS po_order_qty_calc   FROM ( SELECT  DISTINCT process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,Inv_Purchasing_Supplier_Sub_Group,phodat,phpoid,pdldat,Sum_po_order_qty     FROM ( ( SELECT  DISTINCT process_date,invoice_date,cin,dc,inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num,Inv_Buyer_Work_Field_Number,Inv_Purchasing_Supplier_Sub_Group      FROM        `{project_name}.{dataset_id}.RCA_UNFILL_PRODUCT_UNAVAILABLE_ON_AA_BACKORDER_CDL`         WHERE   CF_Supplier_Type='HUBSPOKE'  AND NOT((LF_Ship_To_Location_Num=26  OR (LF_Ship_To_Location_Num<>26   AND inv_purchasing_supplier='90990')) OR (LF_Ship_To_Location_Num=37  OR (LF_Ship_To_Location_Num<>37   AND inv_purchasing_supplier='90967')))AND (Inv_Buyer_Work_Field_Number<>''  OR Inv_Purchasing_Supplier LIKE 'MINHB%')  AND process_date='{process_date}')a   LEFT OUTER JOIN (  SELECT  DISTINCT pdldat,phodat,phpoid, pditem, SHIP_TO_LOCATION_NUM, phsply,SUM(PURCH_ORDER_QTY) AS Sum_po_order_qty   FROM ( SELECT   c.*, d.pdldat  FROM (  SELECT DISTINCT SAFE_CAST(mtrl_num AS int) pditem, purch_doc_type,SAFE_CAST(SUBSTR(plant_01,2,3) AS int) ship_to_location_num,PURCH_ORDER_VENDOR_NUM phsply,PURCH_ORDER_QTY AS PURCH_ORDER_QTY, cncl_dte pdcdat, safe.parse_DATE('%Y%m%d', CAST(EXPCT_DLVRY_DTE AS string)) pdoed, safe.parse_DATE( '%Y%m%d',CAST(PURCH_DOC_DTE AS string)) phodat, SAFE_CAST(PURCH_DOC_NUM AS int) PHPOID,LINE_STAT pdlsts, PLANT_01 phclnt, CONV_QTY, CONV_ORDER_QTY_TO_BASE,QTY_RCV   FROM    `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL`) c    INNER JOIN ( SELECT DISTINCT PURCH_DOC_NUM, MTRL_NUM, CLIENT_ID, BYPS_LEAD_TIM_LINE, MAX(safe.parse_DATE('%Y%m%d', CAST(ACTUAL_GOODS_RCPT_DTE AS string))) pdldat   FROM   `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY`   GROUP BY    PURCH_DOC_NUM,MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE )d   ON    c.pditem=SAFE_CAST(d.mtrl_num AS int)   AND c.phpoid=SAFE_CAST(d.purch_doc_num AS int)   AND SAFE_CAST(SUBSTR(client_id,2,3) AS int)=ship_to_location_num)  WHERE   SAFE_CAST(phsply AS int64) NOT BETWEEN 90000  AND 99999  AND purch_doc_type IN ('ZPNB','ZPOB')  AND PHSPLY <> '57334'  AND PDLSTS<>'Open'  AND phclnt NOT IN ('099B','019B','071R','072R','073R','074R','078R', '087R','088R','703R','707R','099X') AND ship_to_location_num=99  GROUP BY  pdldat,phodat,phpoid,pditem,SHIP_TO_LOCATION_NUM,phsply )b   ON   a.cin=CAST(b.pditem AS numeric) AND DATE_DIFF(a.invoice_date,b.pdldat,day) BETWEEN 1  AND 30) )   GROUP BY     process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,po_order_qty_calc ) tc ON   main.process_date=tc.process_date   AND main.invoice_date=tc.invoice_date   AND main.cin=tc.cin   AND IFNULL(main.Inv_Purchasing_Supplier,'')=IFNULL(tc.Inv_Purchasing_Supplier,'') WHERE   IFNULL(CF_po_order_qty,0)<>IFNULL(po_order_qty_calc,0)",
			"SELECT main.*, CF_po_order_qty, tc.po_order_qty_calc FROM ( SELECT Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num, CF_po_order_qty   FROM  `{project_name}.{dataset_id}.RCA_UNFILL_PRODUCT_UNAVAILABLE_ON_AA_BACKORDER_CDL`   WHERE     CF_Supplier_Type='NONCENTRALIZED'   AND process_date='{process_date}'   AND NOT((LF_Ship_To_Location_Num=26   OR (LF_Ship_To_Location_Num<>26   AND Inv_Purchasing_Supplier='90990'))   OR (LF_Ship_To_Location_Num=37  OR ( LF_Ship_To_Location_Num<>37   AND Inv_Purchasing_Supplier='90967')))AND (Inv_Buyer_Work_Field_Number<>''       OR Inv_Purchasing_Supplier_Sub_Group LIKE 'MINHB%') ) main LEFT OUTER JOIN (   SELECT  DISTINCT process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num,ROUND(IFNULL(Sum_po_order_qty,0),2) AS po_order_qty_calc   FROM ( SELECT  DISTINCT process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,phodat,phpoid,pdldat,Sum_po_order_qty,LF_Ship_To_Location_Num  FROM ( ( SELECT   DISTINCT process_date, invoice_date,cin,dc,inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num,Inv_Buyer_Work_Field_Number         FROM    `{project_name}.{dataset_id}.RCA_UNFILL_PRODUCT_UNAVAILABLE_ON_AA_BACKORDER_CDL`   WHERE    CF_Supplier_Type='NONCENTRALIZED'AND NOT((LF_Ship_To_Location_Num=26  OR (LF_Ship_To_Location_Num<>26  AND inv_purchasing_supplier='90990')) OR (LF_Ship_To_Location_Num=37 OR (LF_Ship_To_Location_Num<>37  AND inv_purchasing_supplier='90967')))  AND (Inv_Buyer_Work_Field_Number<>''  OR Inv_Purchasing_Supplier_Sub_Group LIKE 'MINHB%') AND process_date='{process_date}')a  LEFT OUTER JOIN ( SELECT  DISTINCT pdldat,phodat,phpoid,pditem,SHIP_TO_LOCATION_NUM,phsply, SUM(PURCH_ORDER_QTY) AS Sum_po_order_qty FROM ( SELECT c.*, d.pdldat  FROM ( SELECT  DISTINCT SAFE_CAST(mtrl_num AS int) pditem, purch_doc_type,SAFE_CAST(SUBSTR(plant_01,2,3) AS int) ship_to_location_num,PURCH_ORDER_VENDOR_NUM phsply,PURCH_ORDER_QTY AS PURCH_ORDER_QTY,cncl_dte pdcdat,safe.parse_DATE('%Y%m%d',CAST(EXPCT_DLVRY_DTE AS string)) pdoed,safe.parse_DATE('%Y%m%d',CAST(PURCH_DOC_DTE AS string)) phodat, safe_cast (PURCH_DOC_NUM AS int) PHPOID, LINE_STAT pdlsts, PLANT_01 phclnt, CONV_QTY, CONV_ORDER_QTY_TO_BASE, QTY_RCV FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL`) c  INNER JOIN (  SELECT  DISTINCT PURCH_DOC_NUM, MTRL_NUM, CLIENT_ID, BYPS_LEAD_TIM_LINE, MAX(safe.parse_DATE('%Y%m%d',CAST(ACTUAL_GOODS_RCPT_DTE AS string))) pdldat  FROM  `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY`   GROUP BY  PURCH_DOC_NUM,MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE)d ON c.pditem=SAFE_CAST(d.mtrl_num AS int)   AND c.phpoid=SAFE_CAST(d.purch_doc_num AS int)   AND SAFE_CAST(SUBSTR(client_id,2,3) AS int)= ship_to_location_num)  WHERE  SAFE_CAST(phsply AS int64) NOT BETWEEN 90000 AND 99999  AND purch_doc_type IN ('ZPNB','ZPOB')  AND PHSPLY <>'57334'  AND PDLSTS<>'Open' AND phclnt NOT IN ('099B','019B','071R','072R','073R', '074R','078R','087R','088R','703R','707R','099X')  AND ship_to_location_num <> 99   GROUP BY           pdldat,phodat,phpoid,pditem,SHIP_TO_LOCATION_NUM,phsply)b   ON    a.cin=CAST(b.pditem AS numeric)   AND a.LF_Ship_To_Location_Num=b.ship_to_location_num   AND DATE_DIFF(a.invoice_date,b.pdldat,day) BETWEEN 1  AND 30) )   GROUP BY     process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num, po_order_qty_calc) tc ON   main.process_date=tc.process_date   AND main.invoice_date=tc.invoice_date   AND main.cin=tc.cin   AND main.LF_Ship_To_Location_Num=tc.LF_Ship_To_Location_Num   AND IFNULL(main.Inv_Purchasing_Supplier,'')= IFNULL(tc.Inv_Purchasing_Supplier,'') WHERE   IFNULL(CF_po_order_qty,0)<>IFNULL(po_order_qty_calc,0)",
			"select main.*,tc.CF_Network_Rec_Qty,tc.CF_Network_Rec_Qty_Calc,case when ifnull(round(CF_Network_Rec_Qty,2),0)<>ifnull(round(CF_Network_Rec_Qty_calc,2),0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where   process_date='{process_date}' and CF_Supplier_Type='HUBSPOKE' and ifnull(lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8')  and LF_Ship_To_Location_Num not in (26,37)) main left outer join (select process_date,invoice_date,cin,lf_ship_to_location_num,CF_Network_Rec_Qty,inv_purchasing_supplier, ifnull(case  when inv_purchasing_supplier='90990' then sum(qty_26) when inv_purchasing_supplier='90967' then sum(qty_37) end,0) CF_Network_Rec_Qty_Calc from (select  a.process_date,a.invoice_date,a.cin,a.lf_ship_to_location_num,a.CF_Network_Rec_Qty,inv_purchasing_supplier,pditem,phpoid,ifnull(case when b.ship_to_location_num=26 then pdqtyr else 0 end,0) qty_26,ifnull(case when b.ship_to_location_num=37 then pdqtyr else 0 end,0) qty_37 from(select distinct process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Buyer_Work_Field_Number,Inv_Purchasing_Supplier_Sub_Group,inv_purchasing_supplier,CF_Network_Rec_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' and CF_Supplier_Type='HUBSPOKE' and ifnull(lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8')  and LF_Ship_To_Location_Num not in (26,37))a left outer join (select distinct pdldat,phodat,phpoid,pditem,SHIP_TO_LOCATION_NUM,phsply,(RCV_QTY*CONV_QTY)/CONV_ORDER_QTY_TO_BASE PDQTYR from (select c.*,d.pdldat,d.RCV_QTY from (select distinct safe_cast(mtrl_num as int) pditem,safe_cast(trim(PLANT_01,'P') as int) ship_to_location_num,PURCH_ORDER_VENDOR_NUM phsply,cncl_dte pdcdat,EXPCT_DLVRY_DTE pdoed,PURCH_DOC_DTE phodat,safe_cast(PURCH_DOC_NUM as int) PHPOID,LINE_STAT pdlsts,PLANT_01 phclnt,CONV_QTY,CONV_ORDER_QTY_TO_BASE,QTY_RCV,PURCH_DOC_TYPE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where ifnull(safe_cast(PURCH_ORDER_VENDOR_NUM as int),0)<>57334)c inner join  (SELECT  PURCH_DOC_NUM,  MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE,ACTUAL_GOODS_RCPT_DTE pdldat,sum(case when safe_cast(MVMT_TYPE as int)=101 then RCV_QTY when safe_cast(MVMT_TYPE as int)=102 then (-1)*RCV_QTY end) RCV_QTY FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where safe_cast(MVMT_TYPE as int) in (101,102) group by PURCH_DOC_NUM,  MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE,ACTUAL_GOODS_RCPT_DTE)d on c.pditem=safe_cast(d.mtrl_num as int) and c.phpoid=safe_cast(d.purch_doc_num as int) and safe_cast(trim(client_id,'P') as int)=ship_to_location_num) where  safe_cast(phsply as int) not between 90000 and 99999 and purch_doc_type in ('ZPNB', 'ZPOB') and PHSPLY <> '57334' and PDLSTS<>'Open' and phclnt not in ('099B','019B','071R','072R','073R','074R','078R','087R','088R','703R','707R','099X') and SHIP_TO_LOCATION_NUM in (26,37))b  on a.cin=b.pditem  and date_diff(invoice_date,pdldat,day) between 1 and 30 )group by process_date,invoice_date,cin,lf_ship_to_location_num,inv_purchasing_supplier,CF_Network_Rec_Qty) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and main.lf_ship_to_location_num=tc.lf_ship_to_location_num and ifnull(main.Inv_Purchasing_Supplier,'')=ifnull(tc.Inv_Purchasing_Supplier,'') where ifnull(round(CF_Network_Rec_Qty,2),0)<>ifnull(round(CF_Network_Rec_Qty_calc,2),0)"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,lf_ship_to_location_num,cf_network_rec_qty FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
		},
		"TEST_CASE_7": {
			"description":"To verify calculation for Network Forecast Quantity When searched for a particular process date, invoice date and CIN and forecast quantity is inspected Then for centralised supplier, Network Forecast Quantity is calculated at CIN level And for non-centralised supplier, Network Forecast Quantity is calculated at CIN-shipping location level",
			"type": "RCA",
			"sql_query":["select distinct main.*,max_fcst,min_fcst,tc.CF_Network_Forecast_Qty_Calc,case when ifnull(CF_MIN_MAX_Network_Forecast_Qty,0)<>ifnull( cf_network_forecast_qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER, Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,CF_MIN_MAX_Network_Forecast_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL`a where process_date='{process_date}' and cf_supplier_type='CENTRALIZED'  and ifnull( lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD', 'Z8')) main left outer join (select *,case when max_fcst>min_fcst and max_fcst<1.25*min_fcst then max_fcst else min_fcst end CF_Network_Forecast_Qty_calc from (select distinct process_date, invoice_date,cin,inv_purchasing_supplier,round(sum(max_fcst),2) max_fcst,round(sum( min_fcst),2) min_fcst  from (select  process_date,invoice_date, cin,inv_purchasing_supplier,case when max_rnk=1 then skfcst else 0 end max_fcst,case when min_rnk=1 then skfcst else 0 end min_fcst from (select * from (select distinct process_date,invoice_date,cin,inv_purchasing_supplier, CF_Network_Rec_Qty,phodat,pdldat,rank() over(partition by process_date,  invoice_date,cin,inv_purchasing_supplier order by pdldat desc,phodat asc) max_rnk,rank() over(partition by process_date,invoice_date,cin, inv_purchasing_supplier order by pdldat asc,phodat asc) min_rnk from (   (select distinct process_date,invoice_date,cin,dc, inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num,Inv_Buyer_Work_Field_Number from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' and cf_supplier_type='CENTRALIZED'  and ifnull( lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8'))a left outer join (select c.*,d.pdldat,d. pdqtyr from (select distinct safe_cast(mtrl_num as int) pditem,safe_cast(trim(PLANT_01,'P') as int) ship_to_location_num,PURCH_ORDER_VENDOR_NUM phsply,cncl_dte pdcdat,reason_for_chg,ORGNL_EXPCT_DLVRY_DTE pdoed,PURCH_DOC_DTE phodat,safe_cast(PURCH_DOC_NUM as int) PHPOID,LINE_STAT pdlsts, PLANT_01 phclnt,CONV_QTY,CONV_ORDER_QTY_TO_BASE,Purch_Order_Qty,QTY_RCV,purch_doc_type from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where  ifnull(safe_cast(PURCH_ORDER_VENDOR_NUM as int),0)<>57334 )c left outer join  ( SELECT distinct PURCH_DOC_NUM,  MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE,ACTUAL_GOODS_RCPT_DTE pdldat,QTY_RCV pdqtyr FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where ifnull(safe_cast(SUPPLIER_ID as int),0)<>57334 )d on c.pditem=safe_cast(d.mtrl_num as int) and c.phpoid=safe_cast(d.purch_doc_num as int) and safe_cast(trim(client_id,'P') as int)=ship_to_location_num where safe_cast(phsply as int) not between 90000 and 99999 and purch_doc_type in ('ZPNB',   'ZPOB') and PHSPLY <> '57334'  and phclnt not in ('099B','019B','071R','072R','073R','074R','078R','087R','088R','703R','707R','099X') and ship_to_location_num=99)b on a.cin=cast(b.pditem as numeric)  and  date_diff(a.invoice_date,b.pdldat,day) between 1 and 30 )) where max_rnk=1 or min_rnk=1)po inner join ((select a.* from (select distinct SNPSHT_DTE snapshot_date,safe_cast(MTRL_NUM as int ) skitem,PLANT skclnt,safe_cast(substr  (plant,2,3) as int) location_num, DEMAND_FCST_FOR_FCST skfcst,CLIENT_ID,safe_cast(PURCH_SUPPLIER  as int) sksply,BUYER_WORK_FIELD_NUM, PURCH_SUPPLIER_SBGRP from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where snpsht_dte between date('{process_date}') -450 and date('{process_date}') )a  where (safe_cast(trim(skclnt,'P') as int)=99 or ((safe_cast(trim(skclnt,'P') as int)<>99) and (a. sksply =90163 or   (a.sksply =90990 and  ( trim(BUYER_WORK_FIELD_NUM) <> ''  or PURCH_SUPPLIER_SBGRP like'MINHB%')) or (a.sksply =90967 and  (trim( BUYER_WORK_FIELD_NUM) <> ''  or PURCH_SUPPLIER_SBGRP like'MINHB%')))))  and CLIENT_ID not in ('099B','019B','071R','072R','073R','074R','078R', '087R','088R','703R','707R','099X'))) inv on po.cin=inv.skitem and po.phodat-1=inv.snapshot_date ) group by process_date,invoice_date,cin, inv_purchasing_supplier) ) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and ifnull(main.Inv_Purchasing_Supplier,'')=ifnull(tc.Inv_Purchasing_Supplier,'') where ifnull(CF_MIN_MAX_Network_Forecast_Qty,0)<>ifnull( cf_network_forecast_qty_calc,0)",
			"select distinct main.*,max_fcst,min_fcst,tc.CF_Network_Forecast_Qty_Calc,case when ifnull(CF_MIN_MAX_Network_Forecast_Qty,0)<>ifnull( cf_network_forecast_qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER, Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,CF_Network_Rec_Qty,CF_MIN_MAX_Network_Forecast_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL`a where process_date='{process_date}' and cf_supplier_type= 'HUBSPOKE'  and ifnull(lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8') ) main left outer join (select *,case when max_fcst>min_fcst and max_fcst<1.25*min_fcst then max_fcst else min_fcst end CF_Network_Forecast_Qty_calc from (select distinct process_date, invoice_date,cin,inv_purchasing_supplier,dc,round(sum(max_fcst),2) max_fcst,round(sum(min_fcst),2) min_fcst  from (select  process_date , invoice_date,cin,inv_purchasing_supplier,dc,case when max_rnk=1 then (case  when Inv_Purchasing_Supplier='90990' or dc=26 then qty_26 else qty_37 end) else 0 end max_fcst,case when min_rnk=1 then (case  when Inv_Purchasing_Supplier='90990' or dc=26 then qty_26 else qty_37 end) else 0 end min_fcst from (select * from (select distinct process_date,invoice_date,cin,dc,inv_purchasing_supplier,CF_Network_Rec_Qty,phodat,pdldat,rank() over(  partition by process_date,invoice_date,cin,inv_purchasing_supplier,dc order by pdldat desc,phodat asc) max_rnk,rank() over(partition by process_date ,invoice_date,cin,inv_purchasing_supplier,dc order by pdldat asc,phodat asc) min_rnk from (      (select distinct process_date, invoice_date,cin,dc, inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num,Inv_Buyer_Work_Field_Number from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' and cf_supplier_type='HUBSPOKE'  and ifnull( lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8'))a left outer join (select c.*,d.pdldat ,d. pdqtyr from (select distinct safe_cast(mtrl_num as int) pditem,safe_cast(trim(PLANT_01,'P') as int) ship_to_location_num,safe_cast( PURCH_ORDER_VENDOR_NUM as int) phsply,cncl_dte pdcdat,reason_for_chg,ORGNL_EXPCT_DLVRY_DTE pdoed,PURCH_DOC_DTE phodat,safe_cast(PURCH_DOC_NUM as int  ) PHPOID,LINE_STAT pdlsts,PLANT_01 phclnt,CONV_QTY,CONV_ORDER_QTY_TO_BASE,Purch_Order_Qty,QTY_RCV,purch_doc_type from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where  ifnull(safe_cast(PURCH_ORDER_VENDOR_NUM as int),0)<>57334 )c left outer join  (SELECT distinct PURCH_DOC_NUM,  MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE,ACTUAL_GOODS_RCPT_DTE pdldat,QTY_RCV pdqtyr FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where ifnull(safe_cast(SUPPLIER_ID as int),0)<>57334 )d on c.pditem=safe_cast(d.mtrl_num as int) and c.phpoid=safe_cast(d.purch_doc_num as int) and safe_cast(trim(client_id,'P') as int)=ship_to_location_num where purch_doc_type in ('ZPNB', 'ZPOB') and   PHSPLY <> 57334  and phclnt not in ('099B','019B','071R','072R','073R','074R','078R','087R','088R','703R','707R','099X') and (ship_to_location_num  in (26,37) or phsply in (90990,90967)))b on a.cin=cast(b.pditem as numeric)  and  date_diff(a.invoice_date,b.pdldat,day) between 1 and 30 and (((dc = 26 or inv_purchasing_supplier='90990') and (ship_to_location_num=26  or phsply=90990)) or ((dc=37 or inv_purchasing_supplier='90967') and ( ship_to_location_num=37  or phsply=90967))))) where max_rnk=1 or min_rnk=1)po inner join (select snapshot_date,skitem,skclnt,location_num, ifnull( case when location_num=26 or sksply=90990 then skfcst else 0 end,0) qty_26,ifnull(case when location_num=37 or sksply=90967 then skfcst else 0 end,0  ) qty_37,sksply,BUYER_WORK_FIELD_NUM skbwkj,PURCH_SUPPLIER_SBGRP skssub from (select SNPSHT_DTE snapshot_date,safe_cast(MTRL_NUM as int) skitem, PLANT skclnt,safe_cast(trim(plant,'P') as int) location_num, DEMAND_FCST_FOR_FCST skfcst from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where snpsht_dte between date('{process_date}')-450 and date('{process_date}'))a inner join (Select safe_cast( MTRL_NUM as int) MTRL_NUM,PLANT,BUYER_WORK_FIELD_NUM,trim(PURCH_SUPPLIER_SBGRP) PURCH_SUPPLIER_SBGRP,safe_cast(PURCH_SUPPLIER  as int) sksply , SNPSHT_DTE,safe_cast(PURCH_SUPPLIER  as int) PURCH_SUPPLIER from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` where snpsht_dte   between date('{process_date}')-450 and date('{process_date}'))b on a.skitem=b.mtrl_num and a.skclnt=b.plant  and a. snapshot_date=b.snpsht_dte where (location_num in (26,37) or sksply in (90990,90967))  and (trim(BUYER_WORK_FIELD_NUM)<>'' or PURCH_SUPPLIER_SBGRP like 'MINHB%'))inv on po.cin=inv.skitem and po.phodat-1=inv.snapshot_date  ) group by process_date,invoice_date,cin,dc,inv_purchasing_supplier) ) tc   on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and ifnull(main.Inv_Purchasing_Supplier,'')=ifnull(  tc.Inv_Purchasing_Supplier,'') and main.dc=tc.dc where ifnull(CF_MIN_MAX_Network_Forecast_Qty,0)<>ifnull(cf_network_forecast_qty_calc,0)",
			"select distinct main.*,max_fcst,min_fcst,tc.CF_Network_Forecast_Qty_Calc,case when ifnull(CF_MIN_MAX_Network_Forecast_Qty,0)<>ifnull( cf_network_forecast_qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER, Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,CF_Network_Rec_Qty,CF_MIN_MAX_Network_Forecast_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL`a where process_date='{process_date}' and cf_supplier_type='NONCENTRALIZED'  and ifnull( lf_short_code,'') not in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8') ) main left outer join (select *,case when max_fcst>min_fcst and max_fcst<1.25*min_fcst then max_fcst else min_fcst end CF_Network_Forecast_Qty_calc from (select distinct process_date, invoice_date,cin,inv_purchasing_supplier,dc,round(sum(max_fcst),2) max_fcst,round(sum(min_fcst),2) min_fcst  from (select  process_date,invoice_date ,cin,inv_purchasing_supplier,dc,case when max_rnk=1 then skfcst else 0 end max_fcst,case when min_rnk=1 then skfcst else 0 end min_fcst from (select  * from (select distinct process_date,invoice_date,cin,dc,inv_purchasing_supplier,CF_Network_Rec_Qty,phodat,pdldat,rank() over(partition by process_date,invoice_date,cin,inv_purchasing_supplier,dc order by pdldat desc,phodat asc) max_rnk,rank() over(partition by process_date,invoice_date ,cin,inv_purchasing_supplier,dc order by pdldat asc,phodat asc) min_rnk from (      (select distinct process_date,invoice_date,cin,dc, inv_purchasing_supplier,CF_Network_Rec_Qty,LF_Ship_To_Location_Num,Inv_Buyer_Work_Field_Number from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' and cf_supplier_type='NONCENTRALIZED'  and ifnull(lf_short_code,'') not  in ('01','IO','04','BR','BC') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8'))a left outer join (select c.*,d.pdldat,d.pdqtyr from (select distinct safe_cast(mtrl_num as int) pditem,safe_cast(trim(PLANT_01,'P') as int) ship_to_location_num,PURCH_ORDER_VENDOR_NUM phsply,cncl_dte pdcdat, reason_for_chg,ORGNL_EXPCT_DLVRY_DTE pdoed,PURCH_DOC_DTE phodat,safe_cast(PURCH_DOC_NUM as int) PHPOID,LINE_STAT pdlsts,PLANT_01 phclnt,CONV_QTY, CONV_ORDER_QTY_TO_BASE,Purch_Order_Qty,QTY_RCV,purch_doc_type from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where  ifnull(safe_cast(PURCH_ORDER_VENDOR_NUM as int),0)<>57334 )c left outer join  (SELECT distinct PURCH_DOC_NUM,  MTRL_NUM,CLIENT_ID,BYPS_LEAD_TIM_LINE ,ACTUAL_GOODS_RCPT_DTE pdldat,QTY_RCV pdqtyr FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where ifnull(safe_cast(SUPPLIER_ID as int),0)<>57334 )d on c.pditem=safe_cast(d.mtrl_num as int) and c.phpoid=safe_cast(d.purch_doc_num as int) and safe_cast(trim(client_id,'P') as int)= ship_to_location_num where purch_doc_type in ('ZPNB', 'ZPOB') and PHSPLY <> '57334'  and phclnt not in ('099B','019B','071R','072R','073R','074R', '078R','087R','088R','703R','707R','099X') )b on a.cin=cast(b.pditem as numeric)  and  date_diff(a.invoice_date,b.pdldat,day) between 1 and 30 and a.dc=b.ship_to_location_num)) where max_rnk=1 or min_rnk=1)po inner join ((select a.* from (select distinct SNPSHT_DTE snapshot_date,safe_cast( MTRL_NUM as int) skitem,PLANT skclnt,safe_cast(substr(plant,2,3) as int) location_num, DEMAND_FCST_FOR_FCST skfcst,CLIENT_ID,safe_cast( PURCH_SUPPLIER  as int) sksply,BUYER_WORK_FIELD_NUM,PURCH_SUPPLIER_SBGRP from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where snpsht_dte between date('{process_date}')-450 and date('{process_date}'))a  where  CLIENT_ID not in ('099B','019B','071R','072R' ,'073R','074R','078R','087R','088R','703R','707R','099X')))inv on po.cin=inv.skitem and po.phodat-1=inv.snapshot_date and po.dc=inv.location_num ) group by process_date,invoice_date,cin,dc,inv_purchasing_supplier) ) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and ifnull(main.Inv_Purchasing_Supplier,'')=ifnull(tc.Inv_Purchasing_Supplier,'') and main.dc=tc.dc where ifnull( CF_MIN_MAX_Network_Forecast_Qty,0)<>ifnull(cf_network_forecast_qty_calc,0)"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select  process_date,invoice_date,cin,dc,lf_ship_to_location_num,CF_MIN_MAX_Network_Forecast_Qty FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
		},
		"TEST_CASE_8": {
			"description":"To verify calculation for Network Backorder Quantity When searched for a particular process date, invoice date and CIN and backorder quantity is inspected Then for centralised supplier, Network Backorder Quantity is calculated at CIN level And for non-centralised supplier, Network Backorder Quantity is calculated at CIN-shipping location level",
			"type": "RCA",
			"sql_query":["select main.*,tc.CF_Network_Backorder_Qty,tc.CF_Network_Backorder_Qty_Calc,case when ifnull(CF_Network_Backorder_Qty,0)<>ifnull(CF_Network_Backorder_Qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' and (CF_Supplier_Type='CENTRALIZED')) main left outer join (select process_date,invoice_date,cin,Inv_Purchasing_Supplier,CF_Network_backorder_Qty,round(sum(skobak),2) CF_Network_backorder_Qty_Calc from (select distinct process_date,invoice_date,cin,Inv_Purchasing_Supplier,skobak,CF_Network_backorder_Qty,skclnt,location_num,snapshot_date from ((select distinct process_date,invoice_date,cin,dc,Inv_Purchasing_Supplier,lf_ship_to_location_num,CF_Network_backorder_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where (CF_Supplier_Type='CENTRALIZED')  and process_date='{process_date}' )a left outer join (select a.*,skobak,BUYER_WORK_FIELD_NUM skbwkj,PURCH_SUPPLIER_SBGRP skssub from (select SNPSHT_DTE snapshot_date,safe_cast(MTRL_NUM as int) skitem,PLANT skclnt,safe_cast(trim(plant,'P') as int) location_num,CLIENT_ID,safe_cast(PURCH_SUPPLIER  as int) PURCH_SUPPLIER from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where snpsht_dte between date('{process_date}')-2 and date('{process_date}') )a inner join (Select safe_cast(MTRL_NUM as int) MTRL_NUM,PLANT,BUYER_WORK_FIELD_NUM,PURCH_SUPPLIER_SBGRP,safe_cast(PURCH_SUPPLIER  as int) PURCH_SUPPLIER,CUSTOMER_BACK_ORDER_QTY skobak ,SNPSHT_DTE  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` where snpsht_dte between date('{process_date}')-2 and date('{process_date}'))b on a.skitem=b.mtrl_num and a.skclnt=b.plant  and a.snapshot_date=b.snpsht_dte where (safe_cast(trim(plant,'P') as int)=99 or ((safe_cast(trim(plant,'P') as int)<>99) and (safe_cast(a.PURCH_SUPPLIER  as int) =90163 or   (safe_cast(a.PURCH_SUPPLIER  as int) =90990 and  (trim(BUYER_WORK_FIELD_NUM) <> ''  or PURCH_SUPPLIER_SBGRP like'MINHB%')) or (safe_cast(a.PURCH_SUPPLIER  as int) =90967 and  (trim(BUYER_WORK_FIELD_NUM) <> ''  or PURCH_SUPPLIER_SBGRP like'MINHB%'))))) and CLIENT_ID not in ('099B','019B','071R','072R','073R','074R','078R','087R','088R','703R','707R','099X'))b on a.cin=cast(b.skitem as numeric) and invoice_date-1=snapshot_date and (safe_cast(a.inv_purchasing_supplier as int)=safe_cast(b.PURCH_SUPPLIER  as int) or safe_cast(a.inv_purchasing_supplier as int)=90163 )   )  ) group by process_date,invoice_date,cin,Inv_Purchasing_Supplier,CF_Network_backorder_Qty) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and main.Inv_Purchasing_Supplier=tc.Inv_Purchasing_Supplier where ifnull(CF_Network_Backorder_Qty,0)<>ifnull(CF_Network_Backorder_Qty_calc,0)",
    		"select main.*,tc.CF_Network_Backorder_Qty,tc.CF_Network_Backorder_Qty_Calc,case when ifnull(CF_Network_Backorder_Qty,0)<>ifnull(CF_Network_Backorder_Qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' and CF_Supplier_Type='HUBSPOKE') main left outer join (select process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,CF_Network_Backorder_Qty, ifnull(case  when Inv_Purchasing_Supplier='90990' or lf_ship_to_location_num=26 then round(sum(qty_26),2) when Inv_Purchasing_Supplier='90967' or lf_ship_to_location_num=37 then round(sum(qty_37),2) end,0) CF_Network_Backorder_Qty_Calc from (select distinct a.process_date,a.invoice_date,a.cin,a.lf_ship_to_location_num,a.CF_Network_Backorder_Qty,Inv_Purchasing_Supplier, qty_26,qty_37,snapshot_date,skclnt,sksply,location_num from ((select distinct process_date,invoice_date,cin,dc,Inv_Purchasing_Supplier,lf_ship_to_location_num,CF_Network_Backorder_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='HUBSPOKE'  and process_date='{process_date}' )a left outer join (select snapshot_date,skitem,skclnt,location_num, ifnull(case when location_num=26 or sksply=90990 then skobak else 0 end,0) qty_26,ifnull(case when location_num=37 or sksply=90967 then skobak else 0 end,0) qty_37,sksply,BUYER_WORK_FIELD_NUM skbwkj,PURCH_SUPPLIER_SBGRP skssub from (select SNPSHT_DTE snapshot_date,safe_cast(MTRL_NUM as int) skitem,PLANT skclnt,safe_cast(trim(plant,'P') as int) location_num from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where snpsht_dte between date('{process_date}')-2 and date('{process_date}'))a inner join (Select safe_cast(MTRL_NUM as int) MTRL_NUM,PLANT,BUYER_WORK_FIELD_NUM,PURCH_SUPPLIER_SBGRP,CUSTOMER_BACK_ORDER_QTY skobak,safe_cast(PURCH_SUPPLIER  as int) sksply ,SNPSHT_DTE  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` where snpsht_dte between date('{process_date}')-2 and date('{process_date}'))b on a.skitem=b.mtrl_num and a.skclnt=b.plant  and a.snapshot_date=b.snpsht_dte where (location_num in (26,37) or sksply in (90990,90967))  and (trim(BUYER_WORK_FIELD_NUM)<>'' or PURCH_SUPPLIER_SBGRP like 'MINHB%'))b on a.cin=cast(b.skitem as numeric) and snapshot_date=invoice_date-1   ) ) group by process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,CF_Network_Backorder_Qty ) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and main.lf_ship_to_location_num=tc.lf_ship_to_location_num and main.Inv_Purchasing_Supplier=tc.Inv_Purchasing_Supplier where ifnull(CF_Network_Backorder_Qty,0)<>ifnull(CF_Network_Backorder_Qty_calc,0)",
			"select main.*,tc.CF_Network_Backorder_Qty,tc.CF_Network_Backorder_Qty_Calc,case when ifnull(CF_Network_Backorder_Qty,0)<>ifnull(CF_Network_Backorder_Qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' and CF_Supplier_Type='NONCENTRALIZED') main left outer join (select process_date,invoice_date,cin,Inv_Purchasing_Supplier,lf_ship_to_location_num,CF_Network_Backorder_Qty,round(sum(skobak),2) CF_Network_Backorder_Qty_Calc from (select distinct process_date,invoice_date,cin,skobak,Inv_Purchasing_Supplier,CF_Network_Backorder_Qty,skclnt,lf_ship_to_location_num,snapshot_date from ((select distinct process_date,invoice_date,cin,dc,Inv_Purchasing_Supplier,lf_ship_to_location_num,CF_Network_Backorder_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='NONCENTRALIZED' and process_date='{process_date}' )a left outer join (select dd.SNPSHT_DTE snapshot_date,safe_cast(dd.MTRL_NUM as int) skitem,dd.PLANT skclnt,safe_cast(trim(dd.plant,'P') as int) location_num, inv.CUSTOMER_BACK_ORDER_QTY skobak,safe_cast(inv.PURCH_SUPPLIER  as int) sksply from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` dd, `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` inv  where dd.mtrl_num=inv.mtrl_num and dd.plant=inv.plant and dd.snpsht_dte=inv.snpsht_dte and dd.snpsht_dte between date('{process_date}')-120 and date('{process_date}') and safe_cast(dd.PURCH_SUPPLIER as int)<>57334 and safe_cast(safe_cast(inv.PURCH_SUPPLIER  as int) as int)<>57334 and  safe_cast(trim(dd.plant,'P') as int)<>99 and not(safe_cast(inv.PURCH_SUPPLIER  as int) between 90000 and 99999))b on a.cin=cast(b.skitem as numeric) and a.lf_ship_to_location_num=b.location_num and invoice_date-1=snapshot_date) ) group by process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,CF_Network_Backorder_Qty ) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and main.lf_ship_to_location_num=tc.lf_ship_to_location_num and main.Inv_Purchasing_Supplier=tc.Inv_Purchasing_Supplier where ifnull(CF_Network_Backorder_Qty,0)<>ifnull(CF_Network_Backorder_Qty_calc,0)"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select  process_date,invoice_date,cin,dc,lf_ship_to_location_num,cf_network_backorder_qty FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"

		},
		"TEST_CASE_9": {
			"description":"To verify calculation for Network Holdout Quantity When searched for a particular process date, invoice date and CIN and holdout quantity is inspected Then for centralised supplier, Network Holdout Quantity is calculated at CIN level And for non-centralised supplier, Network Holdout Quantity is calculated at CIN-shipping location level",
			"type": "RCA",
			"sql_query":["select main.*,tc.CF_Network_Holdout_Qty,tc.CF_Network_Holdout_Qty_Calc,case when ifnull(CF_Network_Holdout_Qty,0)<>ifnull(CF_Network_Holdout_Qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where (CF_Supplier_Type='CENTRALIZED') and process_date='{process_date}') main left outer join (select process_date,invoice_date,cin,inv_purchasing_supplier,round(sum(hdqty),2) CF_Network_holdout_Qty_Calc,CF_Network_holdout_Qty from (select distinct process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_holdout_Qty,ifnull(hdqty,0) hdqty,hdbdat,hdedat,hdclnt,HDSEQ_NUM from(select distinct process_date,invoice_date,cin,dc,inv_purchasing_supplier,lf_ship_to_location_num,CF_Network_holdout_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where (CF_Supplier_Type='CENTRALIZED' ) and process_date='{process_date}' )a left outer join (select hditem,hdbdat,hdedat,hdclnt,HDSEQ_NUM,sksply, hdqty,snapshot_date,skbwkj,skssub from ((select safe_cast(MTRL_NUM as int) hditem,hold_qty hdqty,HOLD_BEGIN_DTE hdbdat,HOLD_END_DTE hdedat,plant hdclnt,seq_num HDSEQ_NUM from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_HOLDOUT`) po inner join (select a.*,BUYER_WORK_FIELD_NUM skbwkj,PURCH_SUPPLIER_SBGRP skssub from (select SNPSHT_DTE snapshot_date,safe_cast(MTRL_NUM as int) skitem,PLANT skclnt,safe_cast(trim(PLANT,'P') as int) location_num, DEMAND_FCST_FOR_FCST skfcst,CLIENT_ID,safe_cast(PURCH_SUPPLIER  as int) sksply from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where snpsht_dte between date('{process_date}')-2 and date('{process_date}'))a inner join (Select safe_cast(MTRL_NUM as int) MTRL_NUM,PLANT,BUYER_WORK_FIELD_NUM,PURCH_SUPPLIER_SBGRP,safe_cast(PURCH_SUPPLIER  as int) sksply ,SNPSHT_DTE  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` where snpsht_dte between date('{process_date}')-2 and date('{process_date}'))b on a.skitem=b.mtrl_num and a.skclnt=b.plant  and a.snapshot_date=b.snpsht_dte)sdc on hditem=skitem and safe_cast(trim(hdclnt,'P') as int)=location_num and REGEXP_CONTAINS(hdclnt,'P')) where client_id not in ('099B','019B','071R','072R','073R','074R','078R','087R','088R','703R','707R','099X')  and (((location_num = 99 )or (location_num <> 99 and (sksply in (90163,90990,90967)) and trim(skbwkj)='' and skssub not like '%MINHB%' ))) )b on  a.cin=cast(b.hditem as numeric) and invoice_date between HDBDAT and HDEDAT and invoice_date-1=snapshot_date and  (safe_cast(a.inv_purchasing_supplier as int)=b.sksply or safe_cast(a.inv_purchasing_supplier as int)=90163 ) ) group by process_date,invoice_date,cin,inv_purchasing_supplier,CF_Network_holdout_Qty  ) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and ifnull(main.Inv_Purchasing_Supplier,'')=ifnull(tc.Inv_Purchasing_Supplier,'') where ifnull(CF_Network_Holdout_Qty,0)<>ifnull(CF_Network_Holdout_Qty_calc,0)",
			"select main.*,tc.CF_Network_Holdout_Qty,tc.CF_Network_Holdout_Qty_Calc,case when ifnull(CF_Network_Holdout_Qty,0)<>ifnull(CF_Network_Holdout_Qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='HUBSPOKE'  and process_date='{process_date}') main left outer join (select distinct * from (select process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,CF_Network_holdout_Qty, ifnull(case  when Inv_Purchasing_Supplier='90990' or lf_ship_to_location_num=26 then round(sum(qty_26),2) when Inv_Purchasing_Supplier='90967' or lf_ship_to_location_num=37 then round(sum(qty_37),2) end,0) CF_Network_holdout_Qty_Calc from (select distinct a.process_date,a.invoice_date,a.cin,a.lf_ship_to_location_num,a.CF_Network_holdout_Qty,Inv_Purchasing_Supplier, qty_26,qty_37,hditem,hdbdat,hdedat,hdclnt,HDSEQ_NUM,sksply from ((select distinct process_date,invoice_date,cin,dc,Inv_Purchasing_Supplier,lf_ship_to_location_num,CF_Network_holdout_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='HUBSPOKE'  and process_date='{process_date}' )a left outer join (select hditem,hdbdat,hdedat,hdclnt,HDSEQ_NUM,sksply, ifnull(case when safe_cast(trim(HDCLNT,'P') as int)=26 or sksply=90990 then hdqty else 0 end,0) qty_26,ifnull(case when safe_cast(trim(HDCLNT,'P') as int)=37 or sksply=90967 then hdqty else 0 end,0) qty_37,snapshot_date,skbwkj,skssub from ((select safe_cast(MTRL_NUM as int) hditem,hold_qty hdqty,HOLD_BEGIN_DTE hdbdat,HOLD_END_DTE hdedat,plant hdclnt,seq_num HDSEQ_NUM from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_HOLDOUT`) po inner join (select a.*,sksply,BUYER_WORK_FIELD_NUM skbwkj,PURCH_SUPPLIER_SBGRP skssub from (select SNPSHT_DTE snapshot_date,safe_cast(MTRL_NUM as int) skitem,PLANT skclnt,safe_cast(trim(PLANT,'P') as int) location_num, DEMAND_FCST_FOR_FCST skfcst,CLIENT_ID from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where snpsht_dte between date('{process_date}')-2 and date('{process_date}'))a inner join (Select safe_cast(MTRL_NUM as int) MTRL_NUM,PLANT,BUYER_WORK_FIELD_NUM,PURCH_SUPPLIER_SBGRP,safe_cast(PURCH_SUPPLIER  as int) sksply,SNPSHT_DTE  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` where snpsht_dte between date('{process_date}')-2 and date('{process_date}'))b on a.skitem=b.mtrl_num and a.skclnt=b.plant  and a.snapshot_date=b.snpsht_dte)sdc on hditem=skitem and safe_cast(trim(HDCLNT,'P') as int)=location_num) where  (safe_cast(trim(HDCLNT,'P') as int) in (26,37) or sksply in (90967,90990)) and (skbwkj<>'' or skssub like 'MINHB%') )b  on  a.cin=safe_cast(b.hditem as numeric) and invoice_date between HDBDAT and HDEDAT and invoice_Date-1=snapshot_date ) ) group by process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,CF_Network_holdout_Qty )) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and main.lf_ship_to_location_num=tc.lf_ship_to_location_num and main.Inv_Purchasing_Supplier=tc.Inv_Purchasing_Supplier where ifnull(CF_Network_Holdout_Qty,0)<>ifnull(CF_Network_Holdout_Qty_calc,0)",
    		"select main.*,tc.CF_Network_Holdout_Qty,tc.CF_Network_Holdout_Qty_Calc,case when ifnull(CF_Network_Holdout_Qty,0)<>ifnull(CF_Network_Holdout_Qty_calc,0) then 0 else 1 end value_match from (select Process_Date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='NONCENTRALIZED'  and process_date='{process_date}' ) main left outer join (select process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,round(sum(hdqty),2) CF_Network_holdout_Qty_Calc,CF_Network_holdout_Qty from (select distinct process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,CF_Network_holdout_Qty,ifnull(hdqty,0) hdqty,hdbdat,hdedat,hdclnt,HDSEQ_NUM from(select distinct process_date,invoice_date,cin,dc,Inv_Purchasing_Supplier,lf_ship_to_location_num,CF_Network_holdout_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where CF_Supplier_Type='NONCENTRALIZED'  and process_date='{process_date}' )a left outer join (select safe_cast(MTRL_NUM as int) hditem,hold_qty hdqty,HOLD_BEGIN_DTE hdbdat,HOLD_END_DTE hdedat,plant hdclnt,seq_num HDSEQ_NUM from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_HOLDOUT` where safe_cast(trim(plant,'P') as iNt64)<>99 and REGEXP_CONTAINS(PLANT,'P') )b on a.cin=cast(b.hditem as numeric) and a.lf_ship_to_location_num=safe_cast(trim(HDCLNT,'P') as iNt64) and REGEXP_CONTAINS(HDCLNT,'P') and invoice_date between HDBDAT and HDEDAT )group by process_date,invoice_date,cin,lf_ship_to_location_num,Inv_Purchasing_Supplier,CF_Network_holdout_Qty) tc on main.process_date=tc.process_date and main.invoice_date=tc.invoice_date and main.cin=tc.cin and main.lf_ship_to_location_num=tc.lf_ship_to_location_num and main.Inv_Purchasing_Supplier=tc.Inv_Purchasing_Supplier where ifnull(CF_Network_Holdout_Qty,0)<>ifnull(CF_Network_Holdout_Qty_calc,0)"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,lf_ship_to_location_num,cf_network_holdout_qty FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"

		},
		"TEST_CASE_10": {
			"description":"All invoices in RCA 2 should not show short_code as '01' or short id as 'S' When searched for an invoice number and invoice line number for an invoice date #Then the rejection reason for the invoice should be null or 'Z6' Then either lf_shrt_id<>'S' and lf_short_code<>'01'",
			"type": "RCA",
			"sql_query":["select distinct Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' and not(ifnull(lf_short_code,'') not in ('01','IO') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8'))"],
			"top_75":"select distinct tc.*,cs.CF_CIN_Short_Qty from (select Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' ) tc inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)cs on tc.cin=cs.cin"

		},
		"TEST_CASE_11": {
			"description":"All invoices in the table should have short code as not null When searched for a shorted invoice Then the value of LF_Short_Code should match with the source And LF_Short_Code should not be null",
			"type": "RCA",
			"sql_query":["Select t1.*,SHRT_CDE from (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where Process_Date='{process_date}') t1 left outer join (Select safe_cast(BILL_DOC as int) BILL_DOC,safe_cast(BILL_ITEM as int) BILL_ITEM, SHRT_CDE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_CUSTOMER_BILLING` where ifnull(SHRT_CDE,'') not in ('01','04','BR','BC','IO') and ifnull(REASON_FOR_RJCT,'') not in ('ZD','Z8') and ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and bill_dte in (date('{process_date}'),date('{process_date}')-1)) on Invoice_Number=safe_cast(BILL_DOC as int) and Invoice_Line_Number=safe_cast(BILL_ITEM as int)  where  ifnull(LF_Short_Code,'')<>ifnull(SHRT_CDE,'')"
			,"Select Process_date,Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Inv_Purchasing_Supplier,LF_Ship_To_Location_Num,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL`  where ifnull(LF_Short_Code,'')='' and Process_Date='{process_date}'"],
			"top_75":"select distinct tc.*,cs.CF_CIN_Short_Qty from (select process_date,invoice_date,cin,dc,lf_ship_to_location_num,lf_short_code from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' ) tc inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where  process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)cs on tc.cin=cs.cin"

		},
		"TEST_CASE_12": {
			"description":"Verifying count of invoice in RCA2 When searching for any specific invoice date Then total number of invoices in RCA2 matches the count of invoices which was shorted due to limited product",
			"type": "RCA",
			"sql_query":["SELECT DISTINCT Process_date, Invoice_Date, cin, dc, Invoice_Number, INVOICE_LINE_NUMBER, Inv_Purchasing_Supplier, CF_PO_Order_Qty, LF_Ship_To_Location_Num, LF_AA_Code, lf_shrt_id, lf_short_code, CF_Network_Rec_Qty, CF_Network_Forecast_Qty, CF_Network_Backorder_Qty, CF_Network_HOLDOUT_Qty, CF_MIN_PO_ORDER_DATE, CF_MAX_PO_ORDER_DATE FROM `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` fdc WHERE process_date='{process_date}' AND cf_aa_order_status_rca<>'Product Unavailable on AA - Backorder' AND cf_aa_order_status_rca IS NOT NULL AND (( ( IFNULL(Inv_location_num,DC) <>99)   AND ((IFNULL(fdc.CF_Network_Rec_Qty,0) >0  AND IFNULL(fdc.CF_PO_Order_Qty,0) >0 )   OR (IFNULL(fdc.CF_Network_Rec_Qty,0) =0  AND IFNULL(fdc.CF_PO_Order_Qty,0) >0 )   OR (IFNULL(fdc.CF_Network_Rec_Qty,0) >0  AND IFNULL(fdc.CF_PO_Order_Qty,0) =0 )   OR (IFNULL(fdc.CF_Network_Rec_Qty,0) =0  AND IFNULL(fdc.CF_PO_Order_Qty,0) =0  AND fdc.Inv_On_Hand_Days<90 ) )   AND (IFNULL(TRIM(LF_VBAP_SHRT_ID),'') NOT IN ('Z8',  'ZD')  AND IFNULL(LF_Short_Code,'') NOT IN ('01',  'IO',  '04',  'BR',  'BC'))   AND LF_aa_code IS NOT NULL   AND LF_aa_code NOT IN('995',  '980',  '950',  '982')   AND ( IFNULL(fdc.CF_Network_Rec_Qty,0) < (IFNULL(fdc.CF_PO_Order_Qty,0)*0.80) )   AND (IFNULL(fdc.CF_Network_Rec_Qty,0) > (( (4*IFNULL(fdc.CF_MIN_MAX_Network_Forecast_Qty,0)) + IFNULL(fdc.CF_Network_Backorder_Qty,0)+IFNULL (fdc.CF_Network_Holdout_Qty,0))*10/100)  AND IFNULL(fdc.CF_Network_Rec_Qty,0) < (( (4*IFNULL(fdc.CF_MIN_MAX_Network_Forecast_Qty,0)) + IFNULL(fdc.CF_Network_Backorder_Qty,0)+IFNULL(fdc.CF_Network_Holdout_Qty,0))*95/100) ))) EXCEPT DISTINCT SELECT   DISTINCT Process_date,   Invoice_Date,   cin,   dc,   Invoice_Number,   INVOICE_LINE_NUMBER,   Inv_Purchasing_Supplier,   CF_PO_Order_Qty,   LF_Ship_To_Location_Num,   LF_AA_Code,   lf_shrt_id,   lf_short_code,   CF_Network_Rec_Qty,   CF_Network_Forecast_Qty,   CF_Network_Backorder_Qty,   CF_Network_HOLDOUT_Qty,   CF_MIN_PO_ORDER_DATE,   CF_MAX_PO_ORDER_DATE FROM   `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` WHERE   process_date='{process_date}'"],
			"top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,lf_ship_to_location_num,LF_AA_Code,CF_Network_Rec_Qty,CF_MIN_MAX_Network_Forecast_Qty,CF_Network_Backorder_Qty,CF_Network_HOLDOUT_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"

		}
    },
    "project_id": "edr-phm-ai-im-pr-cah",
	"project_name":"edr-phm-ai-im-pr-cah",
    "dataset_id": "UNFILLED_UNITS_DEV",
    "key":"edr-phm-ai-im-pr-cah-fe45d3ea1bae.json",
    "table_id": "RCA_UNFILL_SUPPLIER_LIMITED_PRODUCT_CDL",
	"alphabet_check_column_name": [],
    "alphanumeric_check_column_name": [],
    "length_check_column_name": [],
    "null_check_column_name": [],
    "numeric_check_column_name": []
}