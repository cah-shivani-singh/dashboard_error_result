{
    "test_cases": {
		"TEST_CASE_1" : {
			"description":"Validate column/schema naming convention for RCA_UNFILL_LATE_INTERNAL_PO_CDL When all the columns and data types are matched Then schema naming convention is verified and passed",
			"type": "Schema",
			"sql_query":["SELECT lower(column_name) as column_name ,lower(data_type) as data_type FROM `{project_name}.{dataset_id}`.INFORMATION_SCHEMA.COLUMNS WHERE table_name='RCA_UNFILL_LATE_INTERNAL_PO_CDL'"],
			"top_75":null

		},
        "TEST_CASE_2" : {
            "description":"No duplicate record should display for any line item in the invoice for same process date When searched with process date filter Then each cin-dc-Invoice No.-Invoiceline-Purchase_Order-Invoice_date item no combination should have distinct record",
            "type":"RCA",
            "sql_query":["SELECT Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,count( concat(CIN,'-',DC,'-',Invoice_Number,'-',invoice_line_number,'-',Process_Date,'-',Invoice_Date,'-',Purchase_Order,'-',ASN_Sequence_Number)) as count_cin_dc FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` group by Invoice_Date,cin,dc,Invoice_Number,invoice_line_number,Process_Date,Purchase_Order,ASN_Sequence_Number having Process_Date='{process_date}' and count_cin_dc>1 order by count_cin_dc desc"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (select Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_order,Process_Date FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"

        },
        "TEST_CASE_3" : {
            "description":"Records showing up for RCA11 should have internal supplier detail When searched with invoice date-CIN filter Then PO_Order_Supplier should be marked as internal (PO_Order_Supplier>90000 and PO_Order_Supplier<99999) but not PO_Order_Supplier in (91033, 91032)",
            "type":"RCA",
            "sql_query":["SELECT Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,LF_Order_Supplier FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL`where not ((CAST(LF_Order_Supplier AS NUMERIC) > 90000) and (CAST(LF_Order_Supplier AS NUMERIC) < 99999) and (CAST(LF_Order_Supplier AS NUMERIC) NOT IN (91033, 91032))) and Process_Date='{process_date}'"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (select Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,LF_Order_Supplier from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_4":{
            "description":"Verify Order delivery status is Late for all records displaying in RCA11 When searched with any invoice date filter and ship to location Then Order Delivery status is correctly calculated as 'Late' And all records should display Order Delivery Status as 'Late'",
            "type":"RCA",
            "sql_query":["Select * from (   (SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,Order_Client,LF_Order_Supplier,LF_Order_Date,LF_Last_Received_Date,LF_Orig_Del_Date,LF_Orig_Exp_Del_Date,LF_PO_Cancel_Date,LF_Rec_Qty,CF_CIN_DC_SHORT_QTY FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by Purchase_Order, CIN )    left outer join    (Select MTRL_NUM,PLANT_01,SUPPLY_ISSUE_PLANT,LINE_STAT,QTY_RMN, EXPCT_DLVRY_DTE, ORGNL_EXPCT_DLVRY_DTE,QTY_RCV,PURCH_ORDER_VENDOR_NUM,CNCL_DTE,PURCH_DOC_NUM,PURCH_DOC_ITEM_NUM, PURCH_DOC_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>57334) PO    ON safe_cast(PURCH_DOC_NUM as int)=safe_cast(Purchase_Order as int)  and safe_cast(MTRL_NUM as int)=CIN   and safe_cast(trim(PLANT_01,'P') as int)=LF_Ship_to_Location_Num    left outer join    (SELECT PURCH_DOC_NUM PURCH_DOC_NUM_MM,PURCH_DOC_ITEM_NUM PURCH_DOC_ITEM_NUM_MM,MTRL_NUM MTRL_NUM_MM,CLIENT_ID, max(ACTUAL_GOODS_RCPT_DTE) ACTUAL_GOODS_RCPT_DTE FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where safe_cast(SUPPLIER_ID as int)<>57334 group by PURCH_DOC_NUM,PURCH_DOC_ITEM_NUM,MTRL_NUM,CLIENT_ID) MM ON safe_cast(PO.PURCH_DOC_NUM as int)=safe_cast(PURCH_DOC_NUM_MM as int) and safe_cast(PO.PURCH_DOC_ITEM_NUM as int)=safe_cast(PURCH_DOC_ITEM_NUM_MM as int) and safe_cast(trim(PO.PLANT_01,'P') as int)=safe_cast(trim(MM.CLIENT_ID,'P') as int) and  CIN=safe_cast(MTRL_NUM_MM as int) )  where not (( ACTUAL_GOODS_RCPT_DTE is null AND (ORGNL_EXPCT_DLVRY_DTE< Invoice_Date ))  OR (ORGNL_EXPCT_DLVRY_DTE< ACTUAL_GOODS_RCPT_DTE))  order by Purchase_Order, CIN",
            "SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,Order_Client,LF_Order_Supplier,CF_Order_Delivery_Status,LF_Order_Date,LF_Last_Received_Date,LF_Orig_Del_Date,LF_Orig_Exp_Del_Date,LF_PO_Cancel_Date,LF_Rec_Qty,CF_CIN_DC_SHORT_QTY FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' and CF_Order_Delivery_Status<>'Late' order by Purchase_Order, CIN"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (select Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,Order_Client,LF_Order_Supplier,CF_Order_Delivery_Status from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL`  where Process_Date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_5":{
            "description":"Validate the rejection reason code for RCA 11 When validate rejection code for any given process date Then LF_VBAP_SHRT_ID is not (Z8, ZD) and Short_code is not (01,IO)",
            "type":"RCA",
            "sql_query":["select Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order, LF_VBAP_SHRT_ID,LF_Short_Code from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` kcd where  not ((ifnull(LF_Short_Code,'') not in ('01','IO')) and (ifnull(LF_VBAP_SHRT_ID,'') not in ('Z8', 'ZD'))) and Process_Date='{process_date}'"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (select Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order, LF_SHRT_ID,LF_Short_Code from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` kcd where not ((ifnull(LF_Short_Code,'') in ('01','IO')) and (ifnull(LF_VBAP_SHRT_ID,'') in ('Z8', 'ZD'))) and Process_Date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_6":{
            "description":"Verify whether the LF_PO_Cancel_Date is null in RCA11 table When searched with Process_Date-LF_PO_Cancel_Date filter in RCA11 table for the unfilled invoices Then LF_PO_Cancel_Date should be null for all invoices in RCA11 table",
            "type":"RCA",
            "sql_query":["Select * from (Select a.*,b.INVTRY_SYSTEM_CNCL_DTE from ((SELECT Process_Date,Invoice_Date,CIN,DC,LF_Ship_to_Location_Num,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,LF_INVTRY_SYSTEM_CNCL_DTE FROM `edr-phm-ai-im-pr-cah.UNFILLED_UNITS_DEV.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}')a left outer join (Select MTRL_NUM,purch_doc_num,INVTRY_SYSTEM_CNCL_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL`)b on a.cin=safe_cast(b.mtrl_num as int) and safe_cast(a.purchase_order as int)=safe_cast(b.purch_doc_num as int))) where not(INVTRY_SYSTEM_CNCL_DTE is null or safe_cast(INVTRY_SYSTEM_CNCL_DTE as string)='' or safe_cast(INVTRY_SYSTEM_CNCL_DTE as string)='0')"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,Purchase_Order,LF_PO_Cancel_Date  from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where (LF_PO_Cancel_Date is null or safe_cast(LF_PO_Cancel_Date as string)='' or safe_cast(LF_PO_Cancel_Date as string)='0') and  Process_Date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_7":{
            "description":"Verify the records in RCA11 are internal late POs When validate whether the unfilled invoices are caused by late internal POs Then PO line status is closed or backordered with order qty as 0 in last 7 days for invoices in NLC where received quantity>=0.5*short quantity on a cin-dc level Or PO line status is open or partially open with order qty>0 for invoices in NLC where order quantity>=0.5*short quantity on a cin-dc level if the first condition fails Or PO line status is open or partially open with order qty>0 for invoices in FDC where order quantity>=0.5*short quantity on a cin-dc level if all above condition fails",
            "type":"RCA",
            "sql_query":["Select * from ((SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,Order_Client,LF_Order_Supplier,LF_Order_Date,LF_Last_Received_Date,LF_Orig_Del_Date,LF_Orig_Exp_Del_Date,LF_PO_Cancel_Date,LF_Rec_Qty,CF_CIN_DC_SHORT_QTY FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by Purchase_Order, CIN )    left outer join    (Select MTRL_NUM,PLANT_01,SUPPLY_ISSUE_PLANT,LINE_STAT,QTY_RMN, EXPCT_DLVRY_DTE, ORGNL_EXPCT_DLVRY_DTE,QTY_RCV,PURCH_ORDER_VENDOR_NUM,CNCL_DTE,PURCH_DOC_NUM,PURCH_DOC_ITEM_NUM, PURCH_DOC_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>57334) PO   ON safe_cast(PURCH_DOC_NUM as int)=safe_cast(Purchase_Order as int)  and safe_cast(MTRL_NUM as int)=CIN    and safe_cast(trim(PLANT_01,'P') as int)=LF_Ship_to_Location_Num left outer join    (SELECT PURCH_DOC_NUM PURCH_DOC_NUM_MM,PURCH_DOC_ITEM_NUM PURCH_DOC_ITEM_NUM_MM,MTRL_NUM MTRL_NUM_MM,CLIENT_ID, max(ACTUAL_GOODS_RCPT_DTE) ACTUAL_GOODS_RCPT_DTE FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where safe_cast(SUPPLIER_ID as int)<>57334 group by PURCH_DOC_NUM,PURCH_DOC_ITEM_NUM,MTRL_NUM,CLIENT_ID) MM ON safe_cast(PO.PURCH_DOC_NUM as int)=safe_cast(PURCH_DOC_NUM_MM as int) and safe_cast(PO.PURCH_DOC_ITEM_NUM as int)=safe_cast(PURCH_DOC_ITEM_NUM_MM as int) and safe_cast(trim(PO.PLANT_01,'P') as int)=safe_cast(trim(MM.CLIENT_ID,'P') as int) and  CIN=safe_cast(MTRL_NUM_MM as int) )  where not ((safe_cast(trim(PLANT_01,'P') as int) = 99 AND (LINE_STAT = 'Closed' or  (LINE_STAT ='B' and QTY_RMN = 0 )) AND DATE_DIFF(Invoice_Date,ACTUAL_GOODS_RCPT_DTE,DAY) >= 0  AND DATE_DIFF(Invoice_Date,ACTUAL_GOODS_RCPT_DTE,DAY) <= 7  AND  QTY_RCV >= ( CF_CIN_DC_SHORT_QTY ) *50/100) OR ((safe_cast(trim(PLANT_01,'P') as int) = 99 AND ((LINE_STAT  = 'Open' or  (LINE_STAT ='Back-Order' and QTY_RMN >0 )) or (LINE_STAT  ='Partial-Open'))) AND QTY_RMN >= ( CF_CIN_DC_SHORT_QTY ) *50/100) OR ((safe_cast(trim(PLANT_01,'P') as int) <> 99 AND ((LINE_STAT  = 'Open' or  (LINE_STAT ='Back-Order' and QTY_RMN >0 )) or (LINE_STAT  ='Partial-Open'))) AND  QTY_RMN >= ( CF_CIN_DC_SHORT_QTY ) *50/100))  order by Purchase_Order, CIN"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,Purchase_Order FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by Invoice_Number,Invoice_Line_Number) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_8":{
            "description":"Validate short codes for the invoices in RCA_UNFILL_LATE_INTERNAL_PO_CDL is not null and matches with the source Billing Model When validate short codes for any given process date Then LF_Short_code should not be null or blank for the shorted invoices And LF_Short_code matches Short_Code in Billing Model",
            "type":"RCA",
            "sql_query":["Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL`  where (LF_Short_Code is null or LF_Short_Code='') and Process_Date='{process_date}'  order by Invoice_Date,Invoice_Number,Invoice_Line_Number",
                        "Select t1.*,SHRT_CDE from (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}') t1 left outer join (Select safe_cast(BILL_DOC as int) BILL_DOC,safe_cast(BILL_ITEM as int) BILL_ITEM, SHRT_CDE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_CUSTOMER_BILLING` where safe_cast(SUPPLIER_NUM as int)<>57334 and BILL_DTE in (date('{process_date}'),date('{process_date}')-1)) on Invoice_Number=safe_cast(BILL_DOC as int) and INVOICE_LINE_NUMBER=safe_cast(BILL_ITEM as int)  where  ifnull(LF_Short_Code,'')<>ifnull(SHRT_CDE,'')"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by Invoice_Number,Invoice_Line_Number) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_9":{
            "description":"Verify the count of records displaying for RCA 11 When validate for any given process date Then number of invoices displaying for cin-dc for customers should be for late internal PO issue",
            "type":"RCA",
            "sql_query":["select * from (SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,Order_Client,LF_Order_Supplier,LF_Order_Date, LF_Last_Received_Date, LF_Orig_Del_Date,LF_Orig_Exp_Del_Date,LF_INVTRY_SYSTEM_CNCL_DTE,LF_PO_Open_Qty,LF_Rec_Qty,CF_CIN_DC_SHORT_QTY, case when CF_Late_Internal_PO_RCA='Late_internal_PO'  then 'Late Internal PO' end as  CF_Late_Internal_PO_RCA FROM `edr-phm-ai-im-pr-cah.UNFILLED_UNITS_DEV..DATAPOINT_UNFILL_INVOICE_PO_CDL`  where Process_Date='{process_date}' and (( (LF_Ship_to_Location_Num = 99 AND (PDLSTS = 'C' or  (PDLSTS ='B' and LF_PO_Open_Qty = 0 )) AND DATE_DIFF(Invoice_Date,LF_Last_Received_Date,DAY) >= 0 AND DATE_DIFF(Invoice_Date, LF_Last_Received_Date,DAY) <= 7 AND  LF_Rec_Qty >= ( CF_CIN_DC_SHORT_QTY ) *50/100) OR((LF_Ship_to_Location_Num = 99 AND ((PDLSTS  = 'O' or  (PDLSTS ='B' and LF_PO_Open_Qty >0 )) or ( PDLSTS  ='P')) ) AND LF_PO_Open_Qty >= ( CF_CIN_DC_SHORT_QTY ) *50/100) OR ((LF_Ship_to_Location_Num <> 99 AND ((PDLSTS  = 'O' or  (PDLSTS ='B' and LF_PO_Open_Qty >0 )) or (PDLSTS  ='P' )) ) AND  LF_PO_Open_Qty >= ( CF_CIN_DC_SHORT_QTY ) *50/100)) AND (CAST(LF_Order_Supplier AS NUMERIC) > 90000) and (CAST(LF_Order_Supplier AS NUMERIC) < 99999) AND (CAST( LF_Order_Supplier AS NUMERIC) NOT IN (91033, 91032)) AND (( LF_Last_Received_Date is null AND LF_Orig_Exp_Del_Date < Invoice_Date )  OR (LF_Orig_Exp_Del_Date  <=LF_Last_Received_Date)) AND (ifnull(trim(LF_VBAP_SHRT_ID),'') NOT IN ('Z8', 'ZD') AND ifnull(LF_SHORT_CODE,'')  NOT IN  ('01','IO')) AND (LF_INVTRY_SYSTEM_CNCL_DTE is NULL or safe_cast(LF_INVTRY_SYSTEM_CNCL_DTE  as string)='' or safe_cast(LF_INVTRY_SYSTEM_CNCL_DTE as string)='0') and purch_doc_type in( 'ZPES','ZPER','ZPRA')  AND REGEXP_CONTAINS(Order_Client, 'P') and (CF_RECEIPT_QTY_LATE/ LF_Order_Item_Qty < 0.9)))a full outer join (SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num, DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,Order_Client, LF_Order_Supplier,LF_Order_Date,LF_Last_Received_Date,LF_Orig_Del_Date,LF_Orig_Exp_Del_Date, LF_INVTRY_SYSTEM_CNCL_DTE,LF_PO_Open_Qty,LF_Rec_Qty,CF_CIN_DC_SHORT_QTY, CF_Late_Internal_PO_RCA FROM `edr-phm-ai-im-pr-cah.UNFILLED_UNITS_DEV.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}')b on a.invoice_number=b. invoice_number and a.invoice_line_number=b.invoice_line_number"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (select Invoice_Date,cin,dc,Invoice_Number,INVOICE_LINE_NUMBER,Process_Date,Purchase_Order FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_10":{
            "description":"Validate the Purch_Doc_Type, PO Status and PO Line Status of orders in RCA 11 When validate purchase orders for any given process date Then Purch_Doc_Type, PO Status and PO Line Status should match the data from PO detail model",
            "type":"RCA",
            "sql_query":["Select * from ((SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,PURCH_DOC_TYPE,PDLSTS,LF_PO_Open_Qty,LF_Order_Status,LF_Order_Line_Status FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by Purchase_Order, CIN ) a left outer join (Select PURCH_DOC_NUM,PURCH_DOC_ITEM_NUM,MTRL_NUM,PLANT_01,SUPPLY_ISSUE_PLANT,PURCH_DOC_TYPE,ORDER_STAT,CASE WHEN ORDER_STAT = 'Open' THEN 'PO Open' WHEN ORDER_STAT ='Partial-Open' THEN 'PO Partial Open'  WHEN ORDER_STAT = 'Closed' THEN 'PO Closed' ELSE 'PO not Available' END AS Order_Status,LINE_STAT,QTY_RMN,CASE WHEN LINE_STAT  = 'Open' or  (LINE_STAT ='Back-Order' and QTY_RMN >0 ) THEN 'PO Line Open'  WHEN LINE_STAT  ='Partial-Open' THEN 'PO Line Partial Open'  WHEN LINE_STAT = 'Closed' or  (LINE_STAT ='Back-Order' and QTY_RMN =0 ) then 'PO Line Closed'  ELSE 'PO Line not Available' END  AS Order_Line_Status from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>57334) b   ON safe_cast(PURCH_DOC_NUM as int)=safe_cast(Purchase_Order as int)  and safe_cast(MTRL_NUM as int)=CIN    and safe_cast(trim(PLANT_01,'P') as int)=LF_Ship_to_Location_Num ) where ((ifnull(a.PURCH_DOC_TYPE,'')<>ifnull(b.PURCH_DOC_TYPE,'')) or (ifnull(LF_Order_Status,'')<>ifnull(Order_Status,'')) or (ifnull(LF_Order_Line_Status,'')<>ifnull(Order_Line_Status,'')))"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (Select Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,PURCH_DOC_TYPE,PDLSTS,LF_PO_Open_Qty,LF_Order_Status,LF_Order_Line_Status FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by Invoice_Number,Invoice_Line_Number) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_11":{
            "description":"Validate the ORDER_CREATE_DTE, Sum_Order_Qty_DC and SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY of orders in RCA 11 When validate invoices for any given process date Then ORDER_CREATE_DTE, Sum_Order_Qty_DC and SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY should match the data from source",
            "type":"RCA",
            "sql_query":["Select dp.*,ORDER_DTE_BM  from ((Select Invoice_Date,LF_CUSTOMER_ORDER_DATE,SAP_SHIP_TO_CUSTOMER_NUMBER,CIN,LF_Ship_To_Location_Num,Invoice_Number,INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}')dp left outer join  (Select  BILL_DTE,ORDER_DOC_DTE ORDER_DTE_BM,safe_cast(SHIP_TO_ACCT as int) SHIP_TO_ACCT,MTRL_NUM,safe_cast(trim(PLANT,'P') as int) PLANT,BILL_TYPE,safe_cast(BILL_DOC as int) BILL_DOC,safe_cast(BILL_ITEM as int) BILL_ITEM  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_CUSTOMER_BILLING` where safe_cast(SUPPLIER_NUM as int)<>57334 and BILL_TYPE='ZP40'  and SALE_ORG='2220'  and DIST_CHNL='10'  and HDR_DIV in ('10','20','30')  and RTRN_REASON='' and PLANT NOT IN ('P095', 'B099', 'B019')) ON Invoice_Number=safe_cast(BILL_DOC as int)  and INVOICE_LINE_NUMBER=safe_cast(BILL_ITEM as int)) where (LF_CUSTOMER_ORDER_DATE<>ORDER_DTE_BM)",
                "select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,CF_Sum_Order_Qty_DC, round(sum(ifnull(sumqty,0)),2) as Sum_Order_Qty_DC,count(ifnull(sumqty,1)) as countqty from  (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,Invoice_Number, INVOICE_LINE_NUMBER,kcd.CF_Sum_Order_Qty_DC, sum(ifnull(order_qty,0)) as sumqty from (select distinct Invoice_Date,Process_Date,CIN,DC,CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct rfrnc_dte_invoice,corp_item_num,ship_to_location_num,ORDER_QTY, Invoice_Num, INVOICE_LINE_NUM,ORDER_DTE from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and Short_Code not in ('BC'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.corp_item_num=kcd.CIN and hd.SHIP_TO_LOCATION_NUM=kcd.DC group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER)  group by Process_Date,Invoice_Date,CIN,DC,Invoice_Number, INVOICE_LINE_NUMBER, CF_Sum_Order_Qty_DC having ifnull(CF_Sum_Order_Qty_DC,0)<>ifnull(Sum_Order_Qty_DC,0)",
                "with pd1 as (select max(process_date) max_pd from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date='{process_date}'),  pd2 as (select max(process_date) min_pd from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date<(select max_pd from pd1)),  pd3 as (Select max(D0_UPDATE_STP)  max_tmp from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL`)  Select  dp.*,cis1.SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY from (Select Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY  from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL`  where Process_Date='{process_date}' ) dp  LEFT OUTER JOIN   (Select corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM,rfrnc_dte_invoice,Invoice_Num,INVOICE_LINE_NUM,sum(Short_Qty) AS SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where SHORT_QTY>0 and ((d0_update_stp>(select min_pd from pd2) and d0_update_stp<=(select max_pd from pd1)) or  ((d0_update_stp<=(select min_pd from pd2) or d0_update_stp>(select max_pd from pd1)) and rfrnc_dte_invoice=date('{process_date}') and concat(Invoice_Num,'-',INVOICE_LINE_NUM) not in (select concat(invoice_number,'-',INVOICE_LINE_NUMBER) from `{project_name}.{dataset_id}.RCA_UNFILL_ALL_DATA_ANALYSIS_CDL` where date(process_date)=(select date(min_pd) from pd2) and process_date<=(select min_pd from pd2) )))  group by corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM,rfrnc_dte_invoice,Invoice_Num,INVOICE_LINE_NUM) cis1  ON cis1.corp_item_num=CIN  and cis1.rfrnc_dte_invoice=Invoice_Date and cis1.SAP_SHIP_TO_CUSTOMER_NUM=SAP_SHIP_TO_CUSTOMER_NUMBER where ifnull(CF_SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY,0)<>ifnull(SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY,0)"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (Select Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,LF_CUSTOMER_ORDER_DATE,CF_Sum_Order_Qty_DC,CF_SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by Invoice_Number,Invoice_Line_Number) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_12":{
            "description":"Validate if RECEIPT_QTY_LATE/PURCH_ORDER_QTY  is less than 90% for the Purchase orders When validate POs in RCA 11 for any given process date Then RECEIPT_QTY_LATE/PURCH_ORDER_QTY should be less than 0.9 for all POs",
            "type":"RCA",
            "sql_query":["SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,PURCH_DOC_TYPE,PDLSTS,LF_PO_Open_Qty,LF_Order_Status,LF_Order_Line_Status,CF_RECEIPT_QTY_LATE,LF_Order_Item_Qty FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}'  and  not(ifnull(CF_RECEIPT_QTY_LATE,0)/LF_Order_Item_Qty<0.9)"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,PURCH_DOC_TYPE,PDLSTS,LF_PO_Open_Qty,LF_Order_Status,LF_Order_Line_Status,CF_RECEIPT_QTY_LATE,LF_Order_Item_Qty FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}'  and (ifnull(CF_RECEIPT_QTY_LATE,0)/LF_Order_Item_Qty<0.9)) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_13":{
            "description":"Validate the CF_RECEIPT_QTY_LATE for the Purchase orders When validate CF_RECEIPT_QTY_LATE of the POs for any given process date Then RECEIPT_QTY_LATE should be calculated as the sum of received quantity for the Movement types 109 and 110",
            "type":"RCA",
            "sql_query":["select a.*,ifnull(sum(case when ifnull(ORGNL_EXPCT_DLVRY_DTE,'1899-12-31')>=ifnull(ACTUAL_DLVRY_DTE,'1899-12-31') then RCV_QTY else 0 end),0)  as RECEIPT_QTY_LATE from (SELECT distinct Process_Date,Invoice_Date,CIN,DC,Invoice_Number,Invoice_Line_Number,Purchase_Order,POLINEITEM,ASN_Shipping_ID,ASN_Sequence_Number,PURCH_DOC_TYPE,LF_Ship_To_Location_Num,LF_Order_Line_Status,CF_Late_Internal_PO_RCA,CF_RECEIPT_QTY_LATE FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where process_date='{process_date}') a left outer join (Select * from ((Select MTRL_NUM,PLANT_01,SUPPLY_ISSUE_PLANT,LINE_STAT,QTY_RMN, ORGNL_EXPCT_DLVRY_DTE,QTY_RCV,PURCH_ORDER_VENDOR_NUM,CNCL_DTE,PURCH_DOC_NUM,PURCH_DOC_ITEM_NUM,PURCH_ORDER_QTY, PURCH_DOC_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>57334 and (CNCL_DTE is null or safe_cast(CNCL_DTE as string)='0') and PURCH_DOC_TYPE in ('ZPES','ZPRA','ZPER')) PO  left outer join (SELECT PURCH_DOC_NUM PURCH_DOC_NUM_MM,PURCH_DOC_ITEM_NUM PURCH_DOC_ITEM_NUM_MM,MTRL_NUM MTRL_NUM_MM,CLIENT_ID,MVMT_TYPE,case when MVMT_TYPE='109' then abs(CALC_ORDER_QTY) when MVMT_TYPE in ('110') then (-1*abs(CALC_ORDER_QTY)) end RCV_QTY, ACTUAL_GOODS_RCPT_DTE,ACTUAL_DLVRY_DTE FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where safe_cast(SUPPLIER_ID as int)<>57334 and STRG_LOCATION='0001' ) MM ON safe_cast(PO.PURCH_DOC_NUM as int)=safe_cast(PURCH_DOC_NUM_MM as int) and safe_cast(PO.PURCH_DOC_ITEM_NUM as int)=safe_cast(PURCH_DOC_ITEM_NUM_MM as int) and PO.PLANT_01=MM.CLIENT_ID and safe_cast(MTRL_NUM as int) =safe_cast(MTRL_NUM_MM as int)  )where MVMT_TYPE in('109','110') and SUBSTR(CLIENT_ID, 1, 1) in ('P') ) b on a.cin=safe_cast(b.MTRL_NUM as int) and a.LF_Ship_to_Location_Num=safe_cast(trim(b.PLANT_01,'P') as int) and safe_cast(Purchase_Order as int)=safe_cast(PURCH_DOC_NUM as int) and safe_cast(POLINEITEM as int)=safe_cast(PURCH_DOC_ITEM_NUM as int)  group by  Process_Date,Invoice_Date,CIN,DC,Invoice_Number,Invoice_Line_Number,Purchase_Order,POLINEITEM,ASN_Shipping_ID,ASN_Sequence_Number,PURCH_DOC_TYPE,LF_Ship_To_Location_Num,LF_Order_Line_Status,CF_Late_Internal_PO_RCA,CF_RECEIPT_QTY_LATE   having ifnull(CF_RECEIPT_QTY_LATE,0)<>ifnull(RECEIPT_QTY_LATE,0)"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (SELECT Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,Purchase_Order,PURCH_DOC_TYPE,PDLSTS,LF_PO_Open_Qty,LF_Order_Status,LF_Order_Line_Status,CF_RECEIPT_QTY_LATE,LF_Order_Item_Qty FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' ) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_14":{
            "description":"Validate NLC to FDC PO Lines are filtered out When validate ACTUAL_GOODS_RCPT_DTE,PURCH_ORDER_VENDOR_NUM of the POs for any given process date Then NLC to FDC PO Lines are filtered out",
            "type":"RCA",
            "sql_query":["Select * from (Select po.*,rca.* FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` rca left join(Select a.*,b.ACTUAL_GOODS_RCPT_DTE from ((Select MTRL_NUM,PURCH_DOC_ITEM_NUM,PURCH_DOC_NUM,PURCH_ORDER_VENDOR_NUM, FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>57334)a left Join (Select PURCH_DOC_ITEM_NUM,PURCH_DOC_NUM,ACTUAL_GOODS_RCPT_DTE  FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where safe_cast(SUPPLIER_ID as int)<>57334)b on a.PURCH_DOC_ITEM_NUM=b.PURCH_DOC_ITEM_NUM and a.PURCH_DOC_NUM=b.PURCH_DOC_NUM))po on safe_cast(rca.Purchase_Order as int)=safe_cast(po.purch_doc_num as int) and rca.cin=safe_cast(po.MTRL_NUM as int))where not(safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>90163 OR date_diff((ACTUAL_GOODS_RCPT_DTE+4),Invoice_date,day)<0 OR ACTUAL_GOODS_RCPT_DTE is null) and process_date='{process_date}'"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (Select * from (Select po.*,rca.* FROM `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` rca left join(Select a.*,b.ACTUAL_GOODS_RCPT_DTE from ((Select MTRL_NUM,PURCH_DOC_ITEM_NUM,PURCH_DOC_NUM,PURCH_ORDER_VENDOR_NUM, FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PURCHASE_ORDER_DETAIL` where safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>57334)a left Join (Select PURCH_DOC_ITEM_NUM,PURCH_DOC_NUM,ACTUAL_GOODS_RCPT_DTE  FROM `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_PO_HISTORY` where safe_cast(SUPPLIER_ID as int)<>57334)b on a.PURCH_DOC_ITEM_NUM=b.PURCH_DOC_ITEM_NUM and a.PURCH_DOC_NUM=b.PURCH_DOC_NUM))po on safe_cast(rca.Purchase_Order as int)=safe_cast(po.purch_doc_num as int) and rca.cin=safe_cast(po.MTRL_NUM as int))where (safe_cast(PURCH_ORDER_VENDOR_NUM as int)<>90163 OR date_diff((ACTUAL_GOODS_RCPT_DTE+4),Invoice_date,day)<0 OR ACTUAL_GOODS_RCPT_DTE is null) and process_date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_LATE_INTERNAL_PO_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by sh.CF_CIN_Short_Qty desc"
        } 
        
    
    },
    "project_id": "edr-phm-ai-im-pr-cah",
	"project_name":"edr-phm-ai-im-pr-cah",
    "dataset_id": "UNFILLED_UNITS_DEV",
    "key":"edr-phm-ai-im-pr-cah-fe45d3ea1bae.json",
    "table_id": "RCA_UNFILL_LATE_INTERNAL_PO_CDL",
	"alphabet_check_column_name": [],
    "alphanumeric_check_column_name": [],
    "length_check_column_name": [],
    "null_check_column_name": [],
    "numeric_check_column_name": []
}