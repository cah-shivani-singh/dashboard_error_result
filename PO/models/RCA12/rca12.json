{
    "test_cases": {
		"TEST_CASE_1" : {
			"description":"Check for schema",
			"type": "Schema",
			"sql_query":["SELECT lower(column_name) as column_name ,lower(data_type) as data_type FROM `{project_name}.{dataset_id}`.INFORMATION_SCHEMA.COLUMNS WHERE table_name='RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL'"],
			"top_75":null

		},
        "TEST_CASE_2" : {
            "description":"No duplicate record should display for any line item in the invoice for same process date When searched with invoice date filter Then each cin-dc-Invoice No.-Invoiceline item no combination should have distinct record",
            "type":"RCA",
            "sql_query":["SELECT Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,count( concat(Invoice_Number,'-',invoice_line_number,'-',Process_Date,'-')) as count_cin_dc FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` group by Invoice_Date,CIN,DC,Invoice_Number,invoice_line_number,Process_Date having count_cin_dc > 1  order by count_cin_dc desc"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (select Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,Process_Date FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}') kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"

        },
        "TEST_CASE_3" : {
            "description":"Validate Ship_to_Location_Num for the shorted invoices When validate Ship_to_Location_Num for the unfilled invoices Then LF_Ship_to_Location_Num should not be 99",
            "type":"RCA",
            "sql_query":["SELECT Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,LF_Ship_to_Location_Num FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where not (LF_Ship_to_Location_Num<>99)  and Process_Date='{process_date}'"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (SELECT Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,LF_Ship_to_Location_Num FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where (LF_Ship_to_Location_Num<>99)  and Process_Date='{process_date}') kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_4":{
            "description":"Validate the rejection reason code for RCA 12 When validate rejection code for any given process date Then LF_VBAP_SHRT_ID is not (Z8, ZD) and Short_code is not (01,IO)",
            "type":"RCA",
            "sql_query":["select Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER, LF_VBAP_SHRT_ID,LF_Short_Code from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` kcd where not ((ifnull(LF_Short_Code,'') not in ('01','IO')) and (ifnull(LF_VBAP_SHRT_ID,'') not in ('Z8', 'ZD'))) and Process_Date='{process_date}'"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER, LF_VBAP_SHRT_ID,LF_Short_Code from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` kcd where ((ifnull(LF_Short_Code,'') not in ('01','IO')) and (ifnull(LF_VBAP_SHRT_ID,'') not in ('Z8', 'ZD'))) and Process_Date='{process_date}')  kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_5":{
            "description":"Validate the A-Class status for RCA 12 When validate A-Class status for any given process date Then Inv_Activity_Class_Code is in (A,M,R,U,W)",
            "type":"RCA",
            "sql_query":["select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, Inv_Activity_Class_Code from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL`  where Inv_Activity_Class_Code not in ('A','M','R','U','W') and Process_Date='{process_date}'"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, Inv_Activity_Class_Code from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL`  where ifnull(Inv_Activity_Class_Code,'') in ('A','M','R','U','W') and Process_Date='{process_date}')  kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_6":{
            "description":"Validate ordered qty does not fall under demand issues When searched with a given process dates for the shorted invoices Then sum of order qty for ship to customer shorted invoice should be less than average + variance for last 16wks for ship to customer if its standard deviation was greater than 0 OR sum of order qty of Affiliation level1 shorted invoice should be less than average + variance for last 16wks for Affiliation level1 if its standard deviation was greater than 0 OR sum of order qty for ship to customer should be equal or less than 2 times of 16 week's average order if its standard deviation was 0 OR sum of order qty for Affiliation level1 should be equal or less than 2 times of 16 week's average order if its standard deviation was 0 OR sum of order qty for ship to customer should be equal or less than 3 times of 16 week's average of ship to customer OR sum of order qty for Affliation1 level should be equal or less than than 3 times of 16 week's average of Affliation1 level OR demand should be there from customer in last 8 weeks on cin-ship_to_Customer level",
            "type":"RCA",
            "sql_query":["SELECT Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, CF_Sum_Order_Qty_Ship_to_Cust,CF_Sum_Order_Qty_Afltn,CF_Average_16week_Order_Qty_Ship_to_Cust,CF_Average_16week_Order_Qty_Afltn,CF_STDDEV_Affiliation1_CIN_Qty , CF_STDDEV2_Affiliation1_CIN_Qty, CF_STDDEV_ShiptoCustomer_CIN_Qty,CF_STDDEV2_ShiptoCustomer_CIN_Qty,CF_Customer_Order_8weeks_Flag FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where not (((CF_STDDEV_ShiptoCustomer_CIN_Qty>0 and CF_Sum_Order_Qty_Ship_to_Cust  <CF_Average_16week_Order_Qty_Ship_to_Cust + CF_STDDEV2_ShiptoCustomer_CIN_Qty ) or  (CF_STDDEV_Affiliation1_CIN_Qty>0 and CF_Sum_Order_Qty_Afltn  < CF_Average_16week_Order_Qty_Afltn + CF_STDDEV2_Affiliation1_CIN_Qty)) or  (((CF_STDDEV_ShiptoCustomer_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Ship_to_Cust < 2*CF_Average_16week_Order_Qty_Ship_to_Cust)) or  ((CF_STDDEV_Affiliation1_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Afltn < 2*CF_Average_16week_Order_Qty_Afltn))) or    ((CF_Sum_Order_Qty_Ship_to_Cust <= 3*CF_Average_16week_Order_Qty_Ship_to_Cust ) or (CF_Sum_Order_Qty_Afltn   <= 3*CF_Average_16week_Order_Qty_Afltn ) ) or   CF_Customer_Order_8weeks_flag = 1) and Process_Date='{process_date}'"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (SELECT Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, CF_Sum_Order_Qty_Ship_to_Cust,CF_Sum_Order_Qty_Afltn,CF_Average_16week_Order_Qty_Ship_to_Cust,CF_Average_16week_Order_Qty_Afltn,CF_STDDEV_Affiliation1_CIN_Qty , CF_STDDEV2_Affiliation1_CIN_Qty, CF_STDDEV_ShiptoCustomer_CIN_Qty,CF_STDDEV2_ShiptoCustomer_CIN_Qty,CF_Customer_Order_8weeks_Flag FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where (((CF_STDDEV_ShiptoCustomer_CIN_Qty>0 and CF_Sum_Order_Qty_Ship_to_Cust  <CF_Average_16week_Order_Qty_Ship_to_Cust + CF_STDDEV2_ShiptoCustomer_CIN_Qty ) or  (CF_STDDEV_Affiliation1_CIN_Qty>0 and CF_Sum_Order_Qty_Afltn  < CF_Average_16week_Order_Qty_Afltn + CF_STDDEV2_Affiliation1_CIN_Qty)) or  (((CF_STDDEV_ShiptoCustomer_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Ship_to_Cust < 2*CF_Average_16week_Order_Qty_Ship_to_Cust)) or  ((CF_STDDEV_Affiliation1_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Afltn < 2*CF_Average_16week_Order_Qty_Afltn))) or    ((CF_Sum_Order_Qty_Ship_to_Cust <= 3*CF_Average_16week_Order_Qty_Ship_to_Cust ) or (CF_Sum_Order_Qty_Afltn   <= 3*CF_Average_16week_Order_Qty_Afltn ) ) or   CF_Customer_Order_8weeks_flag = 1) and Process_Date='{process_date}')  kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_7":{
            "description":"Validate Ordered qty at DC level should be greater than order point qty When searched for any Process date at DC level Then Sum of order quantity for a DC should be greater than order point qty",
            "type":"RCA",
            "sql_query":["SELECT Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, CF_Sum_Order_Qty_DC, CF_Order_Point FROM `edr-phm-ai-im-pr-cah.UNFILLED_UNITS_DEV.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where not ((ifnull(CF_Sum_Order_Qty_DC,0)>ifnull(CF_Order_Point,0))=true OR (CF_Sum_7days_Order_Qty_CIN_DC > (ifnull(Inv_SeasonalForecast_Forecasting_Period,0) + ifnull(Inv_Total_Committed_Units_Calculated,0)))) and Process_Date='{process_date}'"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (SELECT Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, CF_Sum_Order_Qty_DC, CF_Order_Point FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where (CF_Sum_Order_Qty_DC > CF_Order_Point) and Process_Date='{process_date}' )  kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_8":{
            "description":"Validate the sum order quantity for ship_to_customer for RCA 12 When sum of ordered qty of ship_to_customer calculated on distinct order date for a given process date Then Sum_Order_Qty_Ship_to_Cust in RCA12 table is calculated as sum of order qty on distinct order date on cin-dc-ship_to_customer level",
            "type":"RCA",
            "sql_query":["select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_Sum_Order_Qty_Ship_to_Cust, round(sum(ifnull(sumqty,0)),2) as totsum,count(ifnull(sumqty,1)) as countqty, LF_CUSTOMER_ORDER_DATE from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,Invoice_Number, INVOICE_LINE_NUMBER,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.CF_Sum_Order_Qty_Ship_to_Cust, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte , LF_CUSTOMER_ORDER_DATE from (select distinct Invoice_Date,Process_Date,CIN,dc,Invoice_Number, INVOICE_LINE_NUMBER,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_Sum_Order_Qty_Ship_to_Cust, LF_CUSTOMER_ORDER_DATE from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct rfrnc_dte_invoice,corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM ,ship_to_location_num,order_dte, order_qty,Invoice_Num, INVOICE_LINE_NUM from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice in (date('{process_date}'),date('{process_date}')-1) and order_dte between date('{process_date}')-114 and date('{process_date}'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.order_dte=kcd.LF_CUSTOMER_ORDER_DATE and hd.corp_item_num=kcd.cin and hd.SHIP_TO_LOCATION_NUM=kcd.dc and hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Process_Date,kcd.Invoice_Date,kcd.CIN,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.dc,Invoice_Number, INVOICE_LINE_NUMBER, order_dte, LF_CUSTOMER_ORDER_DATE,kcd.CF_Sum_Order_Qty_Ship_to_Cust) group by Process_Date,Invoice_Date,CIN,SAP_SHIP_TO_CUSTOMER_NUMBER,dc,Invoice_Number, INVOICE_LINE_NUMBER, LF_CUSTOMER_ORDER_DATE, CF_Sum_Order_Qty_Ship_to_Cust having CF_Sum_Order_Qty_Ship_to_Cust<>totsum"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_Sum_Order_Qty_Ship_to_Cust, round(sum(ifnull(sumqty,0)),2) as totsum,count(ifnull(sumqty,1)) as countqty, LF_CUSTOMER_ORDER_DATE from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,Invoice_Number, INVOICE_LINE_NUMBER,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.CF_Sum_Order_Qty_Ship_to_Cust, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte , LF_CUSTOMER_ORDER_DATE from (select distinct Invoice_Date,Process_Date,CIN,dc,Invoice_Number, INVOICE_LINE_NUMBER,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_Sum_Order_Qty_Ship_to_Cust, LF_CUSTOMER_ORDER_DATE from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct rfrnc_dte_invoice,corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM ,ship_to_location_num,order_dte, order_qty,Invoice_Num, INVOICE_LINE_NUM from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice in (date('{process_date}'),date('{process_date}')-1) and order_dte between date('{process_date}')-114 and date('{process_date}'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.order_dte=kcd.LF_CUSTOMER_ORDER_DATE and hd.corp_item_num=kcd.cin and hd.SHIP_TO_LOCATION_NUM=kcd.dc and hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Process_Date,kcd.Invoice_Date,kcd.CIN,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.dc,Invoice_Number, INVOICE_LINE_NUMBER, order_dte, LF_CUSTOMER_ORDER_DATE,kcd.CF_Sum_Order_Qty_Ship_to_Cust) group by Process_Date,Invoice_Date,CIN,SAP_SHIP_TO_CUSTOMER_NUMBER,dc,Invoice_Number, INVOICE_LINE_NUMBER, LF_CUSTOMER_ORDER_DATE, CF_Sum_Order_Qty_Ship_to_Cust) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_9":{
            "description":"Validate the sum order quantity for affiliation for RCA 12 When sum of ordered qty of affiliation level1 calculated on distinct order date for a given process date Then CF_Sum_Order_Qty_Afltn in RCA12 table is calculated as sum of order qty on distinct order date on cin-dc-affiliation level1",
            "type":"RCA",
            "sql_query":["select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,LF_L01_AFLTN_NUM,CF_Sum_Order_Qty_Afltn, round(sum(ifnull(sumqty,0)),2) as totsum,count(ifnull(sumqty,1)) as countqty, LF_CUSTOMER_ORDER_DATE from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,Invoice_Number, INVOICE_LINE_NUMBER,kcd.LF_L01_AFLTN_NUM,kcd.CF_Sum_Order_Qty_Afltn, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte , LF_CUSTOMER_ORDER_DATE from (select distinct Invoice_Date,Process_Date,CIN,dc,LF_L01_AFLTN_NUM,CF_Sum_Order_Qty_Afltn, LF_CUSTOMER_ORDER_DATE,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct corp_item_num,L01_AFLTN_NUM,SHIP_TO_LOCATION_NUM,order_qty, order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice in (date('{process_date}'),date('{process_date}')-1) and order_dte between date('{process_date}')-114 and date('{process_date}'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.order_dte=kcd.LF_CUSTOMER_ORDER_DATE and hd.corp_item_num=kcd.cin and hd.SHIP_TO_LOCATION_NUM=kcd.dc and hd.L01_AFLTN_NUM=kcd.LF_L01_AFLTN_NUM  group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.LF_L01_AFLTN_NUM,kcd.CF_Sum_Order_Qty_Afltn, order_dte, LF_CUSTOMER_ORDER_DATE,Invoice_Number, INVOICE_LINE_NUMBER)  group by Process_Date,Invoice_Date,CIN,dc,LF_L01_AFLTN_NUM, CF_Sum_Order_Qty_Afltn , LF_CUSTOMER_ORDER_DATE,Invoice_Number, INVOICE_LINE_NUMBER having CF_Sum_Order_Qty_Afltn<>totsum"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,LF_L01_AFLTN_NUM,CF_Sum_Order_Qty_Afltn, round(sum(ifnull(sumqty,0)),2) as totsum,count(ifnull(sumqty,1)) as countqty, LF_CUSTOMER_ORDER_DATE from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,Invoice_Number, INVOICE_LINE_NUMBER,kcd.LF_L01_AFLTN_NUM,kcd.CF_Sum_Order_Qty_Afltn, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte , LF_CUSTOMER_ORDER_DATE from (select distinct Invoice_Date,Process_Date,CIN,dc,LF_L01_AFLTN_NUM,CF_Sum_Order_Qty_Afltn, LF_CUSTOMER_ORDER_DATE,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct corp_item_num,L01_AFLTN_NUM,SHIP_TO_LOCATION_NUM,order_qty, order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice in (date('{process_date}'),date('{process_date}')-1) and order_dte between date('{process_date}')-114 and date('{process_date}'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.order_dte=kcd.LF_CUSTOMER_ORDER_DATE and hd.corp_item_num=kcd.cin and hd.SHIP_TO_LOCATION_NUM=kcd.dc and hd.L01_AFLTN_NUM=kcd.LF_L01_AFLTN_NUM  group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.LF_L01_AFLTN_NUM,kcd.CF_Sum_Order_Qty_Afltn, order_dte, LF_CUSTOMER_ORDER_DATE,Invoice_Number, INVOICE_LINE_NUMBER)  group by Process_Date,Invoice_Date,CIN,dc,LF_L01_AFLTN_NUM, CF_Sum_Order_Qty_Afltn , LF_CUSTOMER_ORDER_DATE,Invoice_Number, INVOICE_LINE_NUMBER ) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_10":{
            "description":"Validate the Average order quantity of last 16 weeks for ship_to_customer for RCA 12 When average ordered qty of ship_to_customer for the last 16 weeks calculated on distinct order date for a given process date Then CF_Average_16week_Order_Qty_Ship_to_Cust is calculated as the average of order quantity on distinct order date for a given cin and ship_to_customer_number",
            "type":"RCA",
            "sql_query":["select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_Average_16week_Order_Qty_Ship_to_Cust, sum(ifnull(sumqty,0)) as totsum,count(ifnull(sumqty,1)) as countqty, round(sum(ifnull(sumqty,0)) /count(ifnull(sumqty,1)),2) as Average from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.CF_Average_16week_Order_Qty_Ship_to_Cust, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte,Invoice_Number, INVOICE_LINE_NUMBER from (select distinct Invoice_Date,Process_Date,CIN,dc,SAP_SHIP_TO_CUSTOMER_NUMBER,Invoice_Number, INVOICE_LINE_NUMBER,CF_Average_16week_Order_Qty_Ship_to_Cust from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM,SHIP_TO_LOCATION_NUM,order_qty,order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BC','01','IO','BC','04') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8)  hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.cin and  hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.CF_Average_16week_Order_Qty_Ship_to_Cust, order_dte,Invoice_Number, INVOICE_LINE_NUMBER) group by Process_Date,Invoice_Date,CIN,dc,SAP_SHIP_TO_CUSTOMER_NUMBER, CF_Average_16week_Order_Qty_Ship_to_Cust,Invoice_Number, INVOICE_LINE_NUMBER having CF_Average_16week_Order_Qty_Ship_to_Cust<>Average"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_Average_16week_Order_Qty_Ship_to_Cust, sum(ifnull(sumqty,0)) as totsum,count(ifnull(sumqty,1)) as countqty, round(sum(ifnull(sumqty,0)) /count(ifnull(sumqty,1)),2) as Average from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.CF_Average_16week_Order_Qty_Ship_to_Cust, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte,Invoice_Number, INVOICE_LINE_NUMBER from (select distinct Invoice_Date,Process_Date,CIN,dc,SAP_SHIP_TO_CUSTOMER_NUMBER,Invoice_Number, INVOICE_LINE_NUMBER,CF_Average_16week_Order_Qty_Ship_to_Cust from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM,SHIP_TO_LOCATION_NUM,order_qty,order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BC','01','IO','BC','04') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8)  hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.cin and  hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER,kcd.CF_Average_16week_Order_Qty_Ship_to_Cust, order_dte,Invoice_Number, INVOICE_LINE_NUMBER) group by Process_Date,Invoice_Date,CIN,dc,SAP_SHIP_TO_CUSTOMER_NUMBER, CF_Average_16week_Order_Qty_Ship_to_Cust,Invoice_Number, INVOICE_LINE_NUMBER) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_11":{
            "description":"Validate the Average order quantity of last 16 weeks for affiliation for RCA 12 When average ordered qty of affiliation for the last 16 weeks calculated on distinct order date for a given process date Then CF_Average_16week_Order_Qty_Afltn is calculated as the average of order quantity on distinct order date for a given cin, dc and affiliation level 1",
            "type":"RCA",
            "sql_query":["select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,LF_L01_afltn_num,CF_Average_16week_Order_Qty_Afltn, sum(ifnull(sumqty,0)) as totsum,count(ifnull(sumqty,1)) as countqty, round(sum(ifnull(sumqty,0)) /count(ifnull(sumqty,1)),2) as Average from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.LF_L01_afltn_num,kcd.CF_Average_16week_Order_Qty_Afltn, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte,Invoice_Number, INVOICE_LINE_NUMBER from (select distinct Invoice_Date,Process_Date,CIN,dc,LF_L01_afltn_num,CF_Average_16week_Order_Qty_Afltn,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct corp_item_num,L01_afltn_num,SHIP_TO_LOCATION_NUM, order_qty,  order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8)  hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.cin and hd.SHIP_TO_LOCATION_NUM=kcd.dc and hd.L01_afltn_num=kcd.LF_L01_afltn_num group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.LF_L01_afltn_num,kcd.CF_Average_16week_Order_Qty_Afltn, order_dte,Invoice_Number, INVOICE_LINE_NUMBER) group by Process_Date,Invoice_Date,CIN,dc,LF_L01_afltn_num, CF_Average_16week_Order_Qty_Afltn,Invoice_Number, INVOICE_LINE_NUMBER having CF_Average_16week_Order_Qty_Afltn<>Average"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,LF_L01_afltn_num,CF_Average_16week_Order_Qty_Afltn, sum(ifnull(sumqty,0)) as totsum,count(ifnull(sumqty,1)) as countqty, round(sum(ifnull(sumqty,0)) /count(ifnull(sumqty,1)),2) as Average from (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.LF_L01_afltn_num,kcd.CF_Average_16week_Order_Qty_Afltn, sum(ifnull(order_qty,0)) as sumqty, hd.order_dte,Invoice_Number, INVOICE_LINE_NUMBER from (select distinct Invoice_Date,Process_Date,CIN,dc,LF_L01_afltn_num,CF_Average_16week_Order_Qty_Afltn,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct corp_item_num,L01_afltn_num,SHIP_TO_LOCATION_NUM, order_qty,  order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8)  hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.cin and hd.SHIP_TO_LOCATION_NUM=kcd.dc and hd.L01_afltn_num=kcd.LF_L01_afltn_num group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.dc,kcd.LF_L01_afltn_num,kcd.CF_Average_16week_Order_Qty_Afltn, order_dte,Invoice_Number, INVOICE_LINE_NUMBER) group by Process_Date,Invoice_Date,CIN,dc,LF_L01_afltn_num, CF_Average_16week_Order_Qty_Afltn,Invoice_Number, INVOICE_LINE_NUMBER) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_12":{
            "description":"Validate the Variance and Standard deviation of order quantity for ship_to_customer for RCA 12 When standard deviation of ordered qty of ship_to_customer calculated on distinct order date for a given process date And variance of ordered qty of ship_to_customer calculated on distinct order date for a given process date Then CF_STDDEV_ShiptoCustomer_CIN_Qty and CF_STDDEV2_ShiptoCustomer_CIN_Qty is calculated as the stdev and variance of order quantity on distinct order date for a given cin and ship_to_customer_number",
            "type":"RCA",
            "sql_query":["with avgcalc as (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, sum(ifnull(order_qty,0)) as sumqty, ifnull(hd.order_dte,'9999-04-04') as order_dte from (select distinct Invoice_Date,Process_Date,CIN,DC,SAP_SHIP_TO_CUSTOMER_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}')kcd left outer join (select distinct corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM,invoice_type, order_qty, Short_code, order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code ,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8) hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date AND hd.order_qty > 0 and hd.order_dte between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.CIN and hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, order_dte) select distinct rd.Process_Date, rd.Invoice_Date, rd.Invoice_Number, rd.INVOICE_LINE_NUMBER,rd.CIN, rd.DC,rd.SAP_SHIP_TO_CUSTOMER_NUMBER,CF_STDDEV_ShiptoCustomer_CIN_Qty,std STDDEV_ShiptoCustomer, sd.Average from (select * from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}' )rd left outer join (select av.CIN,av.SAP_SHIP_TO_CUSTOMER_NUMBER, av.Invoice_Date,av.Process_Date, av.Average, round(ifnull(cast(sqrt(sum(((ag.sumqty-av.Average)*(ag.sumqty-av.Average)))/av.countqty) as numeric),0),2) as std from (select CIN,SAP_SHIP_TO_CUSTOMER_NUMBER, Invoice_Date, Process_Date, sum(sumqty) as totsum, count(distinct order_dte) as countqty, round(sum(sumqty)/count(distinct order_dte),2) as Average from avgcalc group by CIN,SAP_SHIP_TO_CUSTOMER_NUMBER, Invoice_Date, Process_Date) av inner join avgcalc ag on av.CIN=ag.CIN and av.SAP_SHIP_TO_CUSTOMER_NUMBER=ag.SAP_SHIP_TO_CUSTOMER_NUMBER and av.Process_Date=ag.Process_Date and av.Invoice_Date=ag.Invoice_Date group by av.CIN,av.SAP_SHIP_TO_CUSTOMER_NUMBER, av.Invoice_Date,av.Process_Date,av.Average,av.countqty) sd on rd.CIN=sd.CIN and rd.SAP_SHIP_TO_CUSTOMER_NUMBER=sd.SAP_SHIP_TO_CUSTOMER_NUMBER and rd.Process_Date=sd.Process_Date and rd.Invoice_Date=sd.Invoice_Date where  (rd.CF_STDDEV_ShiptoCustomer_CIN_Qty<>sd.std)",
            "with avgcalc as (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, sum(ifnull(order_qty,0)) as sumqty, ifnull(hd.order_dte,'9999-04-04') as order_dte from (select distinct Invoice_Date,Process_Date,CIN,DC,SAP_SHIP_TO_CUSTOMER_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}')kcd left outer join (select distinct corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM,invoice_type, order_qty, Short_code, order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code ,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8)  hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.CIN and hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, order_dte) select distinct rd.Process_Date, rd.Invoice_Date, rd.Invoice_Number, rd.INVOICE_LINE_NUMBER,rd.CIN, rd.DC,rd.SAP_SHIP_TO_CUSTOMER_NUMBER,CF_STDDEV2_ShiptoCustomer_CIN_Qty,var STDDEV2_ShiptoCustomer, sd.Average from (select * from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}' ) rd left outer join (select av.CIN,av.SAP_SHIP_TO_CUSTOMER_NUMBER, av.Invoice_Date,av.Process_Date, av.Average, round(ifnull(cast(sqrt(sum(((ag.sumqty-av.Average)*(ag.sumqty-av.Average)))/av.countqty) as numeric),0),2)*2  as var from (select CIN,SAP_SHIP_TO_CUSTOMER_NUMBER, Invoice_Date, Process_Date, sum(sumqty) as totsum, count(distinct order_dte) as countqty, round(sum(sumqty)/count(distinct order_dte),2) as Average from avgcalc group by CIN,SAP_SHIP_TO_CUSTOMER_NUMBER, Invoice_Date, Process_Date) av inner join avgcalc ag on av.CIN=ag.CIN and av.SAP_SHIP_TO_CUSTOMER_NUMBER=ag.SAP_SHIP_TO_CUSTOMER_NUMBER and av.Process_Date=ag.Process_Date and av.Invoice_Date=ag.Invoice_Date group by av.CIN,av.SAP_SHIP_TO_CUSTOMER_NUMBER, av.Invoice_Date,av.Process_Date,av.Average,av.countqty)  sd on rd.CIN=sd.CIN and rd.SAP_SHIP_TO_CUSTOMER_NUMBER=sd.SAP_SHIP_TO_CUSTOMER_NUMBER and rd.Process_Date=sd.Process_Date and rd.Invoice_Date=sd.Invoice_Date where  (rd.CF_STDDEV2_ShiptoCustomer_CIN_Qty<>sd.var)"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Invoice_Date,Process_Date,CIN,Invoice_Number, INVOICE_LINE_NUMBER,  SAP_SHIP_TO_CUSTOMER_NUMBER, DC, CF_STDDEV_ShiptoCustomer_CIN_Qty,CF_STDDEV2_ShiptoCustomer_CIN_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_13":{
            "description":"Validate the Variance and Standard deviation order quantity for affiliation1 level for RCA 12 When standard deviation of ordered qty of affiliation1 level calculated on distinct order date for a given process date And variance of ordered qty of affiliation1 level calculated on distinct order date for a given process date Then CF_STDDEV_Affiliation1_CIN_Qty and CF_STDDEV2_Affiliation1_CIN_Qty is calculated as the stdev and variance of order quantity on distinct order date for a given cin, dc and affiliation1 level",
            "type":"RCA",
            "sql_query":["with avgcalc as (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.LF_L01_afltn_num, sum(ifnull(order_qty,0)) as sumqty, ifnull(hd.order_dte,'9999-04-04') as order_dte from (select distinct Invoice_Date,Process_Date,CIN,DC,LF_L01_afltn_num from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}')kcd left outer join (select distinct corp_item_num,L01_AFLTN_NUM,SHIP_TO_LOCATION_NUM,invoice_type, order_qty, Short_code, order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8 )  hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.CIN and hd.SHIP_TO_LOCATION_NUM=kcd.DC and hd.L01_AFLTN_NUM=kcd.LF_L01_afltn_num group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.LF_L01_afltn_num, order_dte) select distinct rd.Process_Date, rd.Invoice_Date, rd.Invoice_Number, rd.INVOICE_LINE_NUMBER,rd.CIN, rd.DC,rd.LF_L01_afltn_num,CF_STDDEV_Affiliation1_CIN_Qty,std STDDEV_Affiliation, sd.Average  from (select * from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}')  rd left outer join (select av.CIN,av.DC,av.LF_L01_afltn_num, av.Invoice_Date,av.Process_Date, av.Average, round(ifnull(cast(sqrt(sum(((ag.sumqty-av.Average)*(ag.sumqty-av.Average)))/av.countqty) as numeric),0),2) as std from (select CIN,DC,LF_L01_afltn_num, Invoice_Date, Process_Date, sum(sumqty) as totsum, count(distinct order_dte) as countqty, round(sum(sumqty)/count(distinct order_dte),2) as Average from avgcalc  group by CIN,DC,LF_L01_afltn_num, Invoice_Date, Process_Date) av inner join  avgcalc ag on av.CIN=ag.CIN and av.DC=ag.DC and av.LF_L01_afltn_num=ag.LF_L01_afltn_num and av.Process_Date=ag.Process_Date and av.Invoice_Date=ag.Invoice_Date group by av.CIN,av.DC,av.LF_L01_afltn_num, av.Invoice_Date,av.Process_Date,av.Average,av.countqty)  sd on rd.CIN=sd.CIN and rd.DC=sd.DC and rd.LF_L01_afltn_num=sd.LF_L01_afltn_num and rd.Process_Date=sd.Process_Date and rd.Invoice_Date=sd.Invoice_Date where  (rd.CF_STDDEV_Affiliation1_CIN_Qty<>sd.std)",
            "with avgcalc as (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.LF_L01_afltn_num, sum(ifnull(order_qty,0)) as sumqty, ifnull(hd.order_dte,'9999-04-04') as order_dte from (select distinct Invoice_Date,Process_Date,CIN,DC,LF_L01_afltn_num from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}')kcd left outer join (select distinct corp_item_num,L01_AFLTN_NUM,SHIP_TO_LOCATION_NUM,invoice_type, order_qty, Short_code, order_dte,Invoice_Num,INVOICE_LINE_NUM,rfrnc_dte_invoice from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice<date('{process_date}') and order_dte between date('{process_date}')-121 and date('{process_date}')-8)  hd on hd.rfrnc_dte_invoice<kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -120  and kcd.Invoice_Date -8 and hd.corp_item_num=kcd.CIN and hd.SHIP_TO_LOCATION_NUM=kcd.DC and hd.L01_AFLTN_NUM=kcd.LF_L01_afltn_num group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.LF_L01_afltn_num, order_dte)  select distinct rd.Process_Date, rd.Invoice_Date, rd.Invoice_Number, rd.INVOICE_LINE_NUMBER,rd.CIN, rd.DC,rd.LF_L01_afltn_num,CF_STDDEV2_Affiliation1_CIN_Qty,var STDDEV2_Affiliation, sd.Average from ( select * from  `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}' ) rd left outer join (select av.CIN,av.DC,av.LF_L01_afltn_num, av.Invoice_Date,av.Process_Date, av.Average, round(ifnull(cast(sqrt(sum(((ag.sumqty-av.Average)*(ag.sumqty-av.Average)))/av.countqty) as numeric),0),2)*2 as var from (select CIN,DC,LF_L01_afltn_num, Invoice_Date, Process_Date, sum(sumqty) as totsum, count(distinct order_dte) as countqty, round(sum(sumqty)/count(distinct order_dte),2) as Average from avgcalc group by CIN,DC,LF_L01_afltn_num, Invoice_Date, Process_Date) av inner join avgcalc ag on av.CIN=ag.CIN and av.DC=ag.DC and av.LF_L01_afltn_num=ag.LF_L01_afltn_num and av.Process_Date=ag.Process_Date and av.Invoice_Date=ag.Invoice_Date group by av.CIN,av.DC,av.LF_L01_afltn_num, av.Invoice_Date,av.Process_Date,av.Average,av.countqty)  sd on rd.CIN=sd.CIN and rd.DC=sd.DC and rd.LF_L01_afltn_num=sd.LF_L01_afltn_num and rd.Process_Date=sd.Process_Date and rd.Invoice_Date=sd.Invoice_Date where  (rd.CF_STDDEV2_Affiliation1_CIN_Qty<>sd.var)"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Invoice_Date,Process_Date,CIN,Invoice_Number, INVOICE_LINE_NUMBER,  LF_L01_afltn_num, DC, CF_STDDEV_Affiliation1_CIN_Qty,CF_STDDEV2_Affiliation1_CIN_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_14":{
            "description":"Validate the demand in last 8 weeks for RCA 12 When validated whether any demand was there from customer in last 8 weeks on cin-ship_to_Customer level Then CF_Customer_Order_8weeks_flag is calculated as demand from customer in last 8 weeks",
            "type":"RCA",
            "sql_query":["select * from (select Invoice_Date,Process_Date,CIN,Invoice_Number, INVOICE_LINE_NUMBER,  SAP_SHIP_TO_CUSTOMER_NUMBER, DC, CF_Customer_Order_8weeks_Flag,(case when countdte=0 then 0 else 1 end) as Flag, countdte from (select distinct kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,  kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, kcd.dc, kcd.CF_Customer_Order_8weeks_Flag,  count(distinct ORDER_DTE) as countdte,Invoice_Number, INVOICE_LINE_NUMBER from (select * from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select * from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where order_dte between date('{process_date}')-65 and date('{process_date}')-8) hd on hd.order_dte between kcd.Invoice_Date -64 and kcd.Invoice_Date -8 and ifnull(hd.Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and hd.order_qty>0 and hd.invoice_type='ZP40' and hd.corp_item_num=kcd.CIN and hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,  kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, kcd.dc, kcd.CF_Customer_Order_8weeks_Flag,Invoice_Number, INVOICE_LINE_NUMBER)) where CF_Customer_Order_8weeks_Flag<>Flag "],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select * from (select Invoice_Date,Process_Date,CIN,Invoice_Number, INVOICE_LINE_NUMBER,  SAP_SHIP_TO_CUSTOMER_NUMBER, DC, CF_Customer_Order_8weeks_Flag,(case when countdte=0 then 0 else 1 end) as Flag, countdte from (select distinct kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,  kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, kcd.dc, kcd.CF_Customer_Order_8weeks_Flag,  count(distinct ORDER_DTE) as countdte,Invoice_Number, INVOICE_LINE_NUMBER from (select * from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select * from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where order_dte between date('{process_date}')-65 and date('{process_date}')-8) hd on hd.order_dte between kcd.Invoice_Date -64 and kcd.Invoice_Date -8 and ifnull(hd.Short_Code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and hd.order_qty>0 and hd.invoice_type='ZP40' and hd.corp_item_num=kcd.CIN and hd.SAP_SHIP_TO_CUSTOMER_NUM=kcd.SAP_SHIP_TO_CUSTOMER_NUMBER group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,  kcd.SAP_SHIP_TO_CUSTOMER_NUMBER, kcd.dc, kcd.CF_Customer_Order_8weeks_Flag,Invoice_Number, INVOICE_LINE_NUMBER)) ) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_15":{
            "description":"Validate the Sum of order quantity for DC for RCA 12 When validated Sum of order quantity for DC for RCA 12 Then calculated Sum of order quantity for DC should match CF_Sum_Order_Qty_DC in RCA12 table",
            "type":"RCA",
            "sql_query":["select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,CF_Sum_Order_Qty_DC, round(sum(ifnull(sumqty,0)),2) as totsum,count(ifnull(sumqty,1)) as countqty from  (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,Invoice_Number, INVOICE_LINE_NUMBER,kcd.CF_Sum_Order_Qty_DC, sum(ifnull(order_qty,0)) as sumqty from (select distinct Invoice_Date,Process_Date,CIN,DC,CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct rfrnc_dte_invoice,corp_item_num,ship_to_location_num,ORDER_QTY, Invoice_Num, INVOICE_LINE_NUM,ORDER_DTE from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and Short_Code not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice in (date('{process_date}'),date('{process_date}')-1) and order_dte between date('{process_date}')-114 and date('{process_date}'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.corp_item_num=kcd.CIN and hd.SHIP_TO_LOCATION_NUM=kcd.DC group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER)  group by Process_Date,Invoice_Date,CIN,DC,Invoice_Number, INVOICE_LINE_NUMBER, CF_Sum_Order_Qty_DC having CF_Sum_Order_Qty_DC<>totsum"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,CF_Sum_Order_Qty_DC, round(sum(ifnull(sumqty,0)),2) as totsum,count(ifnull(sumqty,1)) as countqty from  (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,Invoice_Number, INVOICE_LINE_NUMBER,kcd.CF_Sum_Order_Qty_DC, sum(ifnull(order_qty,0)) as sumqty from (select distinct Invoice_Date,Process_Date,CIN,DC,CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct rfrnc_dte_invoice,corp_item_num,ship_to_location_num,ORDER_QTY, Invoice_Num, INVOICE_LINE_NUM,ORDER_DTE from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and Short_Code not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice in (date('{process_date}'),date('{process_date}')-1) and order_dte between date('{process_date}')-114 and date('{process_date}'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.corp_item_num=kcd.CIN and hd.SHIP_TO_LOCATION_NUM=kcd.DC group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER)  group by Process_Date,Invoice_Date,CIN,DC,Invoice_Number, INVOICE_LINE_NUMBER, CF_Sum_Order_Qty_DC) kcd  inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_16":{
            "description":"Validate the Order point qty for RCA 12 When validated Order point qty for RCA 12 Then calculated Order point qty should match CF_Order_Point in RCA12",
            "type":"RCA",
            "sql_query":["Select cd.* , ifnull(ceil(Order_Point_qty),0) Order_Point_qty from ((Select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,Inv_Replenishment_Point,CF_Order_Point_Date, CF_Order_Point,Inv_Purchasing_Supplier from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}')cd    left outer join  (Select SNPSHT_DTE_INV, MTRL_NUM_INV, PLANT_INV,case when trim(BUYER_WORK_FIELD_NUM_INV)='HUB' and PLANT_INV in (26,37)   then (case when trim(BUYER_WORK_FIELD_NUM_DF)='VRT' and PLANT_INV in (26,37) then sum(ADJ_JOINT_ORDER_POINT_UNIT_DF+TOTAL_COMMIT_UNIT_DF) else sum(ADJ_JOINT_ORDER_POINT_UNIT_INV+TOTAL_COMMIT_UNIT_INV) end)  else sum(ADJ_JOINT_ORDER_POINT_UNIT_INV+TOTAL_COMMIT_UNIT_INV) end as Order_Point_qty from ((Select  SNPSHT_DTE SNPSHT_DTE_INV,safe_cast(MTRL_NUM as int) MTRL_NUM_INV,safe_cast(trim(PLANT,'P') as int) PLANT_INV,RPLNSH_POINT RPLNSH_POINT_INV,ADJ_JOINT_ORDER_POINT_UNIT ADJ_JOINT_ORDER_POINT_UNIT_INV,TOTAL_COMMIT_UNIT TOTAL_COMMIT_UNIT_INV , BUYER_WORK_FIELD_NUM BUYER_WORK_FIELD_NUM_INV   from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` where ifnull(safe_cast(Purch_supplier as int),0)<>57334 and snpsht_dte >=date('{process_date}')-190) inv  left outer join  (Select   SNPSHT_DTE SNPSHT_DTE_DF,safe_cast(MTRL_NUM as int) MTRL_NUM_DF,safe_cast(trim(PLANT,'P') as int) PLANT_DF,trim(RPLNSH_POINT) RPLNSH_POINT_DF,ADJ_JOINT_ORDER_POINT_UNIT ADJ_JOINT_ORDER_POINT_UNIT_DF,TOTAL_COMMIT_UNIT TOTAL_COMMIT_UNIT_DF, BUYER_WORK_FIELD_NUM BUYER_WORK_FIELD_NUM_DF  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where ifnull(safe_cast(Purch_supplier as int),0)<>57334 and PLANT in ('P026','P037') and trim(BUYER_WORK_FIELD_NUM)='VRT' and snpsht_dte >=date('{process_date}')-190) df  on df.MTRL_NUM_DF=inv.MTRL_NUM_INV and df.PLANT_DF=inv.PLANT_INV and df.SNPSHT_DTE_DF=inv.SNPSHT_DTE_INV )  group by SNPSHT_DTE_INV,MTRL_NUM_INV,PLANT_INV,BUYER_WORK_FIELD_NUM_INV,BUYER_WORK_FIELD_NUM_DF)  on SNPSHT_DTE_INV=cd.CF_Order_Point_date-1 AND cd.CIN =MTRL_NUM_INV AND  cd.DC =PLANT_INV  ) where ifnull(ceil(Order_Point_qty),0)<>ifnull(CF_Order_Point,0)"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (Select cd.* , ifnull(ceil(Order_Point_qty),0) Order_Point_qty from ((Select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,Inv_Replenishment_Point,CF_Order_Point_Date, CF_Order_Point,Inv_Purchasing_Supplier from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}')cd    left outer join  (Select SNPSHT_DTE_INV, MTRL_NUM_INV, PLANT_INV,case when trim(BUYER_WORK_FIELD_NUM_INV)='HUB' and PLANT_INV in (26,37)   then (case when trim(BUYER_WORK_FIELD_NUM_DF)='VRT' and PLANT_INV in (26,37) then sum(ADJ_JOINT_ORDER_POINT_UNIT_DF+TOTAL_COMMIT_UNIT_DF) else sum(ADJ_JOINT_ORDER_POINT_UNIT_INV+TOTAL_COMMIT_UNIT_INV) end)  else sum(ADJ_JOINT_ORDER_POINT_UNIT_INV+TOTAL_COMMIT_UNIT_INV) end as Order_Point_qty from ((Select  SNPSHT_DTE SNPSHT_DTE_INV,safe_cast(MTRL_NUM as int) MTRL_NUM_INV,safe_cast(trim(PLANT,'P') as int) PLANT_INV,RPLNSH_POINT RPLNSH_POINT_INV,ADJ_JOINT_ORDER_POINT_UNIT ADJ_JOINT_ORDER_POINT_UNIT_INV,TOTAL_COMMIT_UNIT TOTAL_COMMIT_UNIT_INV , BUYER_WORK_FIELD_NUM BUYER_WORK_FIELD_NUM_INV   from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` where ifnull(safe_cast(Purch_supplier as int),0)<>57334 and snpsht_dte >=date('{process_date}')-190) inv  left outer join  (Select   SNPSHT_DTE SNPSHT_DTE_DF,safe_cast(MTRL_NUM as int) MTRL_NUM_DF,safe_cast(trim(PLANT,'P') as int) PLANT_DF,trim(RPLNSH_POINT) RPLNSH_POINT_DF,ADJ_JOINT_ORDER_POINT_UNIT ADJ_JOINT_ORDER_POINT_UNIT_DF,TOTAL_COMMIT_UNIT TOTAL_COMMIT_UNIT_DF, BUYER_WORK_FIELD_NUM BUYER_WORK_FIELD_NUM_DF  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` where ifnull(safe_cast(Purch_supplier as int),0)<>57334 and PLANT in ('P026','P037') and trim(BUYER_WORK_FIELD_NUM)='VRT' and snpsht_dte >=date('{process_date}')-190) df  on df.MTRL_NUM_DF=inv.MTRL_NUM_INV and df.PLANT_DF=inv.PLANT_INV and df.SNPSHT_DTE_DF=inv.SNPSHT_DTE_INV )  group by SNPSHT_DTE_INV,MTRL_NUM_INV,PLANT_INV,BUYER_WORK_FIELD_NUM_INV,BUYER_WORK_FIELD_NUM_DF)  on SNPSHT_DTE_INV=cd.CF_Order_Point_date-1 AND cd.CIN =MTRL_NUM_INV AND  cd.DC =PLANT_INV  ) ) kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_17":{
            "description":"Validate the Order point Date for RCA 12 When validated Order point date for RCA 12 Then calculated Order point date should match CF_Order_Point_Date in RCA12",
            "type":"RCA",
            "sql_query":["Select * from ( SELECT   a.cin,   a.dc,   a.invoice_line_number,   a.invoice_number,   c.Default_Lead_Time,   a.LF_CUSTOMER_ORDER_DATE AS ORDER_DTE,   c.Order_Day_in_Week_Array,   a.CF_ORDER_POINT_DATE,   EXTRACT(DAYOFWEEK   FROM     a.CF_ORDER_POINT_DATE) AS DAY_OF_WEEK,   CASE     WHEN CAST(EXTRACT(DAYOFWEEK FROM a.CF_ORDER_POINT_DATE) AS STRING) IN UNNEST(SPLIT(CAST(c.Order_Day_in_Week_Array AS STRING),''))     THEN TRUE     ELSE FALSE END   AS is_present FROM   `{project_name}.{dataset_id}.UNFILL_SHORTED_CI_INVDATE_STAGE_CDL` c JOIN   `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` a ON   a.cin = c.corp_item_num   AND a.dc = c.SHIP_TO_LOCATION_NUM   AND a.invoice_number = c.invoice_num   AND a.invoice_line_number = c.invoice_line_num   where a.process_Date='{process_date}'   AND c.Order_Day_in_Week_Array is not null   and a.CF_ORDER_POINT_DATE is not null ) where is_present = false"],
            "top_75":"Select * from ( SELECT   a.cin,   a.dc,   a.invoice_line_number,   a.invoice_number,   c.Default_Lead_Time,   a.LF_CUSTOMER_ORDER_DATE AS ORDER_DTE,   c.Order_Day_in_Week_Array,   a.CF_ORDER_POINT_DATE,   EXTRACT(DAYOFWEEK   FROM     a.CF_ORDER_POINT_DATE) AS DAY_OF_WEEK,   CASE     WHEN CAST(EXTRACT(DAYOFWEEK FROM a.CF_ORDER_POINT_DATE) AS STRING) IN UNNEST(SPLIT(CAST(c.Order_Day_in_Week_Array AS STRING),''))     THEN TRUE     ELSE FALSE END   AS is_present FROM   `{project_name}.{dataset_id}.UNFILL_SHORTED_CI_INVDATE_STAGE_CDL` c JOIN   `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` a ON   a.cin = c.corp_item_num   AND a.dc = c.SHIP_TO_LOCATION_NUM   AND a.invoice_number = c.invoice_num   AND a.invoice_line_number = c.invoice_line_num   where a.process_Date='{process_date}'   AND c.Order_Day_in_Week_Array is not null   and a.CF_ORDER_POINT_DATE is not null ) where is_present = true limit 75"
        },
        "TEST_CASE_18":{
            "description":"Validate short codes for the invoices in RCA12 is not null and matches with the source Billing Model When validate short codes for any given process date Then LF_Short_code should not be null for the shorted invoices And LF_Short_code matches Short_Code in Billing Model",
            "type":"RCA",
            "sql_query":["Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL`  where LF_Short_Code is null and Process_Date='{process_date}'  order by Invoice_Date,Invoice_Number,Invoice_Line_Number",
        "Select t1.*,SHRT_CDE from (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}') t1 left outer join (Select safe_cast(BILL_DOC as int) BILL_DOC,safe_cast(BILL_ITEM as int) BILL_ITEM, SHRT_CDE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_CUSTOMER_BILLING` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(shrt_cde,'') not in ('BR', 'BC', '04') and bill_dte in (date('{process_date}') , date('{process_date}')-1) ) on Invoice_Number=safe_cast(BILL_DOC as int) and INVOICE_LINE_NUMBER=safe_cast(BILL_ITEM as int)  where  ifnull(LF_Short_Code,'')<>ifnull(SHRT_CDE,'')"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}' order by Invoice_Number,Invoice_Line_Number) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_19":{
            "description":"Verify the count of records displaying for RCA 12 When validated for any given process date Then number of invoices displaying for cin-dc for customers should be for CAH demand issue",
            "type":"RCA",
            "sql_query":["select * from (SELECT distinct Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Ship_to_Location_Num,LF_AA_Code,SAP_SHIP_TO_CUSTOMER_NUMBER,LF_L01_AFLTN_NUM,CF_Sum_Order_Qty_Ship_to_Cust, CF_Average_16week_Order_Qty_Ship_to_Cust, CF_STDDEV2_ShiptoCustomer_CIN_Qty,CF_Sum_Order_Qty_Afltn, CF_Average_16week_Order_Qty_Afltn, CF_STDDEV2_Affiliation1_CIN_Qty,CF_STDDEV_ShiptoCustomer_CIN_Qty,CF_Customer_Order_8weeks_Flag,CF_Sum_Order_Qty_DC,CF_Order_Point, Inv_Activity_Class_Code, CF_Demand_Planning_RCA FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where Process_Date='{process_date}' )a full outer join (SELECT distinct Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Ship_to_Location_Num,LF_AA_Code,SAP_SHIP_TO_CUSTOMER_NUMBER,LF_L01_AFLTN_NUM,CF_Sum_Order_Qty_Ship_to_Cust, CF_Average_16week_Order_Qty_Ship_to_Cust, CF_STDDEV2_ShiptoCustomer_CIN_Qty,CF_Sum_Order_Qty_Afltn, CF_Average_16week_Order_Qty_Afltn, CF_STDDEV2_Affiliation1_CIN_Qty,CF_STDDEV_ShiptoCustomer_CIN_Qty,CF_Customer_Order_8weeks_Flag,CF_Sum_Order_Qty_DC,CF_Order_Point,Inv_Activity_Class_Code, case when CF_Demand_Planning_RCA='CAH - Demand Issue' then 'CAH Demand Planning Issue' end as  CF_Demand_Planning_RCA from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where not(((((CF_STDDEV_ShiptoCustomer_CIN_Qty>0 and CF_Sum_Order_Qty_Ship_to_Cust  >= CF_Average_16week_Order_Qty_Ship_to_Cust + CF_STDDEV2_ShiptoCustomer_CIN_Qty ) or  (CF_STDDEV_Affiliation1_CIN_Qty>0 and CF_Sum_Order_Qty_Afltn  >= CF_Average_16week_Order_Qty_Afltn + CF_STDDEV2_Affiliation1_CIN_Qty)) or  (((CF_STDDEV_ShiptoCustomer_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Ship_to_Cust >= 2*CF_Average_16week_Order_Qty_Ship_to_Cust)) or  ((CF_STDDEV_Affiliation1_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Afltn >= 2*CF_Average_16week_Order_Qty_Afltn))) or    ((CF_Sum_Order_Qty_Ship_to_Cust > 3*CF_Average_16week_Order_Qty_Ship_to_Cust ) or (CF_Sum_Order_Qty_Afltn   > 3*CF_Average_16week_Order_Qty_Afltn ) ) or   CF_Customer_Order_8weeks_flag = 0))) and ((((CF_STDDEV_ShiptoCustomer_CIN_Qty>0 and CF_Sum_Order_Qty_Ship_to_Cust  <CF_Average_16week_Order_Qty_Ship_to_Cust + CF_STDDEV2_ShiptoCustomer_CIN_Qty ) or  (CF_STDDEV_Affiliation1_CIN_Qty>0 and CF_Sum_Order_Qty_Afltn  < CF_Average_16week_Order_Qty_Afltn + CF_STDDEV2_Affiliation1_CIN_Qty)) or  (((CF_STDDEV_ShiptoCustomer_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Ship_to_Cust < 2*CF_Average_16week_Order_Qty_Ship_to_Cust)) or  ((CF_STDDEV_Affiliation1_CIN_Qty = 0 )and (CF_Sum_Order_Qty_Afltn < 2*CF_Average_16week_Order_Qty_Afltn))) or    ((CF_Sum_Order_Qty_Ship_to_Cust <= 3*CF_Average_16week_Order_Qty_Ship_to_Cust ) or (CF_Sum_Order_Qty_Afltn   <= 3*CF_Average_16week_Order_Qty_Afltn ) ) or   CF_Customer_Order_8weeks_flag = 1) = true and  (CF_Sum_Order_Qty_DC>CF_Order_Point)=true and   ((LF_Ship_To_Location_Num<>99)=true ) and  ((ifnull(LF_Short_Code,'') not in ('01','IO')) and (ifnull(LF_VBAP_SHRT_ID,'') not in ('Z8', 'ZD')))    and ifnull(Inv_Activity_Class_Code ,'') in ('A','M','R','U','W')) and Process_Date='{process_date}' )b on a.invoice_number=b.invoice_number and a.invoice_line_number=b.invoice_line_number"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty from (select Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,Process_Date FROM `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}') kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        }       
        
    
    },
    "project_id": "edr-phm-ai-im-pr-cah",
	"project_name":"edr-phm-ai-im-pr-cah",
    "dataset_id": "UNFILLED_UNITS_DEV",
    "key":"edr-phm-ai-im-pr-cah-fe45d3ea1bae.json",
    "table_id": "RCA_UNFILL_DEMAND_PLANNING_CAH_DEMAND_CDL",
	"alphabet_check_column_name": [],
    "alphanumeric_check_column_name": [],
    "length_check_column_name": [],
    "null_check_column_name": [],
    "numeric_check_column_name": []
}