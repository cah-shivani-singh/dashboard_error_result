{
    "test_cases": {
		"TEST_CASE_1" : {
			"description":"Validate column/schema naming convention for RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL table  -  for now design doc When all the columns and data types are matched Then schema naming convention is verified and passed",
			"type": "Schema",
			"sql_query":["SELECT lower(column_name) as column_name ,lower(data_type) as data_type FROM `{project_name}.{dataset_id}`.INFORMATION_SCHEMA.COLUMNS WHERE table_name='RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL'"],
			"top_75":null

		},
        "TEST_CASE_2" : {
            "description":"No duplicate record should display for any line item in the invoice for same process date When searched with invoice date filter Then each cin-dc-invoice number-invoice number line item-process date combination should have distinct record",
            "type":"RCA",
            "sql_query":["select b.* from (SELECT invoice_date,cin,dc,invoice_number,invoice_line_number,process_date,count(concat(CIN,'-',DC,'-',Invoice_Number,'-',invoice_line_number,'-',process_date)) as count_cin_dc FROM `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' group by Invoice_Date,cin,dc,Invoice_Number,invoice_line_number,process_date having count_cin_dc>1 )a inner join (select * from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL`)b on a.invoice_date=b.invoice_date and a.process_date=b.process_date and a.CIN=b.cin and a.dc=b.dc and a.invoice_number=b.invoice_number and a.invoice_line_number=b.invoice_line_number"],
            "top_75":"SELECT distinct a.* FROM ( select * from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
        },
        "TEST_CASE_3" : {
            "description":"Check the availability alerts associated with the records When searched for a particular record Then the availability alert code for the record can be null or in (982, 950, 998, 990, 995, 912)",
            "type":"RCA",
            "sql_query":["select * from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where ifnull(LF_AA_Code,'') not in ('982', '950', '998', '990', '995', '912','') and process_date='{process_date}'"],
            "top_75":"select distinct a.*,b.CF_CIN_Short_Qty from (select * from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}')a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by cf_cin_short_qty desc limit 75)b on a.cin=b.cin"
        },
        "TEST_CASE_4":{
            "description":"Check whether the ratio of GCN disruption forecast to GCN total forecast is greater than 20% When calculated for a given invoice date Then GCN_Disruption_Forecast/GCN_Total_Forecast > 20%",
            "type":"RCA",
            "sql_query":["select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,CF_GCN_Disruption_Forecast,CF_GCN_Total_Forecast from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where CF_GCN_Disruption_Forecast/CF_GCN_Total_Forecast<=0.2 and process_date='{process_date}'"],
            "top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,CF_GCN_Disruption_Forecast,CF_GCN_Total_Forecast from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where not(CF_GCN_Disruption_Forecast/CF_GCN_Total_Forecast<=0.2) and process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
        },
        "TEST_CASE_5":{
            "description":"Check whether the 7 days rolling order quantity >= (Standard deviation*Forecast)+ Forecast When calculated for a particular cin and dc Then Sum_7days_Order_Qty_CIN_DC >= (Inv_Deviation_Percentage * Inv_DemandForecast_Forecasting_Period) + Inv_DemandForecast_Forecasting_Period",
            "type":"RCA",
            "sql_query":["select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,CF_Sum_7days_Order_Qty_CIN_DC,LF_Inv_Deviation_Percentage,LF_Inv_DemandForecast_Forecasting_Period from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where CF_Sum_7days_Order_Qty_CIN_DC<((LF_Inv_Deviation_Percentage/100)*LF_Inv_DemandForecast_Forecasting_Period)+LF_Inv_DemandForecast_Forecasting_Period and process_date='{process_date}'"],
            "top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,CF_Sum_7days_Order_Qty_CIN_DC,LF_Inv_Deviation_Percentage,LF_Inv_DemandForecast_Forecasting_Period from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
        },
        "TEST_CASE_6":{
            "description":"Sales orders in RCA 6 table should not be rejected due to reasons other than a DC inventory issue When searched for a particular sales order Then either lf_shrt_id<>'S' and lf_short_code<>'01'",
            "type":"RCA",
            "sql_query":["select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,lf_shrt_id,lf_short_code from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' and not( ifnull(lf_short_code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8'))"],
            "top_75":"SELECT distinct rca.*,top.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,vbap_shrt_id from (select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') a inner join (select rfrnc_dte_invoice,CORP_ITEM_NUM,SHIP_TO_LOCATION_NUM,SUPPLIER_NUM,VBAP_SHRT_ID from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` )b on a.invoice_date=b.rfrnc_dte_invoice and a.cin=b.corp_item_num and a.lf_ship_to_location_num=b.ship_to_location_num and a.inv_purchasing_supplier=cast(b.supplier_num as string)) rca inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)top on rca.cin=top.cin"
        },
        "TEST_CASE_7":{
            "description":"Validate the calculation for GCN disruption forecast When calculated for a particular invoice date and card_gen_seq_num Then GCN_Disruption_Forecast is the total forecast quantity for card_gen_cde_num not in (0,94200), item activity in ('A','M','W') and AA_code is not null and  AA_code not in ('982','998','950','990','995','912')",
            "type":"RCA",
            "sql_query":["select main.*,ifnull(calc.cf_gcn_disruption_forecast_calc,0) cf_gcn_disruption_forecast_calc,case when ifnull(main.cf_gcn_disruption_forecast,0)<>ifnull(cf_gcn_disruption_forecast_calc,0) then 0 else 1 end value_match from ((select distinct Process_Date,invoice_date,Invoice_Number,INVOICE_LINE_NUMBER,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}')main left outer join (select invoice_date,lf_card_gen_seq_num,cf_gcn_disruption_forecast,ifnull(round(sum(skfcst),2),0) cf_gcn_disruption_forecast_calc from(select distinct invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,matnr,CARD_GEN_CDE_NUM,safe_cast(DEMAND_FCST_FOR_FCST as float64) skfcst,plant from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,matnr,CARD_GEN_CDE_NUM,aa_code from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,matnr,CARD_GEN_CDE_NUM,lf_customer_order_datetime from (select distinct process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,lf_customer_order_datetime from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date='{process_date}') a left outer join (select safe_cast(mtrl_num as int64) matnr,ifnull(safe_cast(GEN_CDE_NUM as int),0) card_gen_cde_num,ifnull(safe_cast(CAH_GCN_SEQ_NO as int),0) card_gen_seq_num from `edna-data-pr-cah.VW_PHM_SC_DIMENSION_NP.VW_ORP_MATERIAL` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(`MTRL_CRCTRSTC-DUPLICATEMATERIAL`,'')<>'PUERTO-RICO' and ifnull(`MTRL_CRCTRSTC-PUERTORICO`,'')   in('','NO'))b on a.lf_card_gen_seq_num=b.card_gen_seq_num)cins left outer join (select mtrl_num,EXPDT_CDE aa_code, USER_UPDATE_DTE clndr_dte,chg_dttm,NEXT_CHG_DTTM from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_AVAILABILITY_ALERT_DETAIL` ) aa on cins.matnr=cast(aa.mtrl_num as int) and safe_Cast(lf_customer_order_datetime as datetime) between chg_dttm and next_chg_dttm ) main left outer join (select c.MTRL_NUM,DEMAND_FCST_FOR_FCST,c.plant,c.SNPSHT_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` c,`edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` d where c.mtrl_num=d.mtrl_num and c.plant=d.plant and d.plant not in ('B099','B019','R071','R072','R073','R074','R078','R087','R088','R703','R707','X099','P095','P066')   and c.snpsht_dte=d.snpsht_dte and d.snpsht_dte in (date('{process_date}')-2,date('{process_date}')-1) and d.ACT_CLASS_CDE in ('A','M','R','U','W') and safe_cast(DEMAND_FCST_FOR_FCST as float64)>0 )fct on main.matnr=cast(fct.mtrl_num as int) and main.invoice_date-1=fct.snpsht_dte where ifnull(aa_code,'') not in  ('982','998','950','990','995','912','') and card_gen_cde_num not in (0,94200) ) group by invoice_date,lf_card_gen_seq_num,cf_gcn_disruption_forecast) calc on main.invoice_date=calc.invoice_date and main.lf_card_gen_seq_num=calc.lf_card_gen_seq_num) where ifnull(main.cf_gcn_disruption_forecast,0)<>ifnull(cf_gcn_disruption_forecast_calc,0)"],
            "top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM (select main.*,ifnull(calc.cf_gcn_disruption_forecast_calc,0) cf_gcn_disruption_forecast_calc,case when ifnull(main.cf_gcn_disruption_forecast,0)<>ifnull(cf_gcn_disruption_forecast_calc,0) then 0 else 1 end value_match from ((select distinct Process_Date,invoice_date,Invoice_Number,cin,INVOICE_LINE_NUMBER,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}')main left outer join (select invoice_date,lf_card_gen_seq_num,cf_gcn_disruption_forecast,ifnull(round(sum(skfcst),2),0) cf_gcn_disruption_forecast_calc from(select distinct invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,matnr,CARD_GEN_CDE_NUM,safe_cast(DEMAND_FCST_FOR_FCST as float64) skfcst,plant from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,matnr,CARD_GEN_CDE_NUM,aa_code from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,matnr,CARD_GEN_CDE_NUM,lf_customer_order_datetime from (select distinct process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_disruption_forecast,lf_customer_order_datetime from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date='{process_date}') a left outer join (select safe_cast(mtrl_num as int64) matnr,ifnull(safe_cast(GEN_CDE_NUM as int),0) card_gen_cde_num,ifnull(safe_cast(CAH_GCN_SEQ_NO as int),0) card_gen_seq_num from `edna-data-pr-cah.VW_PHM_SC_DIMENSION_NP.VW_ORP_MATERIAL` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(`MTRL_CRCTRSTC-DUPLICATEMATERIAL`,'')<>'PUERTO-RICO' and ifnull(`MTRL_CRCTRSTC-PUERTORICO`,'')   in('','NO'))b on a.lf_card_gen_seq_num=b.card_gen_seq_num)cins left outer join (select mtrl_num,EXPDT_CDE aa_code, USER_UPDATE_DTE clndr_dte,chg_dttm,NEXT_CHG_DTTM from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_AVAILABILITY_ALERT_DETAIL` ) aa on cins.matnr=cast(aa.mtrl_num as int) and safe_Cast(lf_customer_order_datetime as datetime) between chg_dttm and next_chg_dttm ) main left outer join (select c.MTRL_NUM,DEMAND_FCST_FOR_FCST,c.plant,c.SNPSHT_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` c,`edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` d where c.mtrl_num=d.mtrl_num and c.plant=d.plant and d.plant not in ('B099','B019','R071','R072','R073','R074','R078','R087','R088','R703','R707','X099','P095','P066')   and c.snpsht_dte=d.snpsht_dte and  d.SNPSHT_DTE in (date('{process_date}')-2,date('{process_date}')-1)  and d.ACT_CLASS_CDE in ('A','M','R','U','W') and safe_cast(DEMAND_FCST_FOR_FCST as float64)>0 )fct on main.matnr=cast(fct.mtrl_num as int) and main.invoice_date-1=fct.snpsht_dte where ifnull(aa_code,'') not in  ('982','998','950','990','995','912','') and card_gen_cde_num not in (0,94200) ) group by invoice_date,lf_card_gen_seq_num,cf_gcn_disruption_forecast) calc on main.invoice_date=calc.invoice_date and main.lf_card_gen_seq_num=calc.lf_card_gen_seq_num) ) a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
        },
        "TEST_CASE_8":{
            "description":"Validate the calculation for GCN total forecast When calculated for an invoice date and card_gen_seq_num Then GCN_Total_Forecast is the total forecast quantity for card_gen_cde_num not in (0,94200) and item activity in ('A','M','W')",
            "type":"RCA",
            "sql_query":["select main.*,ifnull(calc.cf_gcn_total_forecast_calc,0) cf_gcn_total_forecast_calc,case when ifnull(main.cf_gcn_total_forecast,0)<>ifnull(cf_gcn_total_forecast_calc,0) then 0 else 1 end value_match from ((select distinct Process_Date,invoice_date,Invoice_Number,INVOICE_LINE_NUMBER,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}')main left outer join (select invoice_date,lf_card_gen_seq_num,cf_gcn_total_forecast,ifnull(round(sum(skfcst),2),0) cf_gcn_total_forecast_calc from(select distinct invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,matnr,CARD_GEN_CDE_NUM,safe_cast(DEMAND_FCST_FOR_FCST as float64) skfcst,plant from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,matnr,CARD_GEN_CDE_NUM,aa_code from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,matnr,CARD_GEN_CDE_NUM,lf_customer_order_datetime from (select distinct process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,lf_customer_order_datetime from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date='{process_date}') a left outer join (select safe_cast(mtrl_num as int64) matnr,ifnull(safe_cast(GEN_CDE_NUM as int),0) card_gen_cde_num,ifnull(safe_cast(CAH_GCN_SEQ_NO as int),0) card_gen_seq_num from `edna-data-pr-cah.VW_PHM_SC_DIMENSION_NP.VW_ORP_MATERIAL` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(`MTRL_CRCTRSTC-DUPLICATEMATERIAL`,'')<>'PUERTO-RICO' and ifnull(`MTRL_CRCTRSTC-PUERTORICO`,'')   in('','NO'))b on a.lf_card_gen_seq_num=b.card_gen_seq_num)cins left outer join (select mtrl_num,EXPDT_CDE aa_code, USER_UPDATE_DTE clndr_dte,chg_dttm,NEXT_CHG_DTTM from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_AVAILABILITY_ALERT_DETAIL` ) aa on cins.matnr=cast(aa.mtrl_num as int) and safe_Cast(lf_customer_order_datetime as datetime) between chg_dttm and next_chg_dttm ) main left outer join (select c.MTRL_NUM,DEMAND_FCST_FOR_FCST,c.plant,c.SNPSHT_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` c,`edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` d where c.mtrl_num=d.mtrl_num and c.plant=d.plant and d.plant not in ('B099','B019','R071','R072','R073','R074','R078','R087','R088','R703','R707','X099','P095','P066') and d.SNPSHT_DTE in (date('{process_date}')-2,date('{process_date}')-1) and c.snpsht_dte=d.snpsht_dte and d.ACT_CLASS_CDE in ('A','M','R','U','W') and safe_cast(DEMAND_FCST_FOR_FCST as float64)>0 )fct on main.matnr=cast(fct.mtrl_num as int) and main.invoice_date-1=fct.snpsht_dte where card_gen_cde_num not in (0,94200) ) group by invoice_date,lf_card_gen_seq_num,cf_gcn_total_forecast) calc on main.invoice_date=calc.invoice_date and main.lf_card_gen_seq_num=calc.lf_card_gen_seq_num)where ifnull(main.cf_gcn_total_forecast,0)<>ifnull(cf_gcn_total_forecast_calc,0)"],
            "top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select main.*,ifnull(calc.cf_gcn_total_forecast_calc,0) cf_gcn_total_forecast_calc,case when ifnull(main.cf_gcn_total_forecast,0)<>ifnull(cf_gcn_total_forecast_calc,0) then 0 else 1 end value_match from ((select distinct Process_Date,invoice_date,cin,Invoice_Number,INVOICE_LINE_NUMBER,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}')main left outer join (select invoice_date,lf_card_gen_seq_num,cf_gcn_total_forecast,ifnull(round(sum(skfcst),2),0) cf_gcn_total_forecast_calc from(select distinct invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,matnr,CARD_GEN_CDE_NUM,safe_cast(DEMAND_FCST_FOR_FCST as float64) skfcst,plant from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,matnr,CARD_GEN_CDE_NUM,aa_code from (select process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,matnr,CARD_GEN_CDE_NUM,lf_customer_order_datetime from (select distinct process_date,invoice_date,LF_Card_Gen_Seq_Num,cf_gcn_total_forecast,lf_customer_order_datetime from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date='{process_date}') a left outer join (select safe_cast(mtrl_num as int64) matnr,ifnull(safe_cast(GEN_CDE_NUM as int),0) card_gen_cde_num,ifnull(safe_cast(CAH_GCN_SEQ_NO as int),0) card_gen_seq_num from `edna-data-pr-cah.VW_PHM_SC_DIMENSION_NP.VW_ORP_MATERIAL` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(`MTRL_CRCTRSTC-DUPLICATEMATERIAL`,'')<>'PUERTO-RICO' and ifnull(`MTRL_CRCTRSTC-PUERTORICO`,'')   in('','NO'))b on a.lf_card_gen_seq_num=b.card_gen_seq_num)cins left outer join (select mtrl_num,EXPDT_CDE aa_code, USER_UPDATE_DTE clndr_dte,chg_dttm,NEXT_CHG_DTTM from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_AVAILABILITY_ALERT_DETAIL` ) aa on cins.matnr=cast(aa.mtrl_num as int) and safe_Cast(lf_customer_order_datetime as datetime) between chg_dttm and next_chg_dttm ) main left outer join (select c.MTRL_NUM,DEMAND_FCST_FOR_FCST,c.plant,c.SNPSHT_DTE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_DEMAND_FCST` c,`edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_INVENTORYSNAPSHOT` d where c.mtrl_num=d.mtrl_num and c.plant=d.plant and d.plant not in ('B099','B019','R071','R072','R073','R074','R078','R087','R088','R703','R707','X099','P095','P066') and d.SNPSHT_DTE in (date('{process_date}')-2,date('{process_date}')-1) and c.snpsht_dte=d.snpsht_dte and d.ACT_CLASS_CDE in ('A','M','R','U','W') and safe_cast(DEMAND_FCST_FOR_FCST as float64)>0 )fct on main.matnr=cast(fct.mtrl_num as int) and main.invoice_date-1=fct.snpsht_dte where card_gen_cde_num not in (0,94200) ) group by invoice_date,lf_card_gen_seq_num,cf_gcn_total_forecast) calc on main.invoice_date=calc.invoice_date and main.lf_card_gen_seq_num=calc.lf_card_gen_seq_num)) a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
        },
        "TEST_CASE_9":{
            "description":"Validate the calculation for 7 days rolling order quantity When checked for a cin and dc Then Sum_7days_Order_Qty_CIN_DC is calculated as the sum of order quantities for all invoices in last 7 days",
            "type":"RCA",
            "sql_query":["select Process_Date,Invoice_Date,CIN,DC,CF_Sum_7days_Order_Qty_CIN_DC,ifnull(sum(order_qty),0) CF_Sum_7days_Order_Qty_CIN_DC_calc from (select distinct process_date,invoice_date,his_inv_dte,cin,dc,CF_Sum_7days_Order_Qty_CIN_DC,order_dte,order_qty,invoice_num,invoice_line_num from (select process_date,invoice_date,cin,dc,CF_Sum_7days_Order_Qty_CIN_DC from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') a left outer join (select rfrnc_dte_invoice his_inv_dte ,corp_item_num,SHIP_TO_LOCATION_NUM,ORDER_DTE,ORDER_QTY,Invoice_Num,INVOICE_LINE_NUM from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40'and ifnull(short_code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and order_qty>0 and order_dte between date('{process_date}')-10 and date('{process_date}'))b on a.cin=b.corp_item_num and a.dc=b.ship_to_location_num and b.order_dte between a.invoice_date-7 and a.invoice_date-1 and date(a.process_date)>=b.his_inv_dte ) group by process_date,invoice_date,cin,dc,CF_Sum_7days_Order_Qty_CIN_DC having CF_Sum_7days_Order_Qty_CIN_DC<>CF_Sum_7days_Order_Qty_CIN_DC_calc"],
            "top_75":"SELECT distinct a.*,b.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,CF_Sum_7days_Order_Qty_CIN_DC from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') a inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)b on a.cin=b.cin"
        },
        "TEST_CASE_10":{
            "description":"All invoices in the table should have short code as not null When searched for a shorted invoice Then the value of LF_Short_Code should match with the source And LF_Short_Code should not be null",
            "type":"RCA",
            "sql_query":["Select t1.*,SHRT_CDE from (Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where Process_Date='{process_date}') t1 left outer join (Select safe_cast(BILL_DOC as int) BILL_DOC,safe_cast(BILL_ITEM as int) BILL_ITEM, SHRT_CDE from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_CUSTOMER_BILLING` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(shrt_cde,'') not in ('BR', 'BC', '04')  and bill_dte in (date('{process_date}')-1,date('{process_date}')) and SLR_SHORT_QTY>0 ) on Invoice_Number=safe_cast(BILL_DOC as int) and Invoice_Line_Number=safe_cast(BILL_ITEM as int)  where  ifnull(LF_Short_Code,'')<>ifnull(SHRT_CDE,'')",
            "Select Process_Date,Invoice_Date,Invoice_Number,INVOICE_LINE_NUMBER,CIN,DC,LF_Short_Code FROM `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL`  where ifnull(LF_Short_Code,'')='' and Process_Date='{process_date}'"],
            "top_75":"select distinct tc.*,cs.CF_CIN_Short_Qty from (select process_date,invoice_date,cin,dc,lf_short_code from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where  process_date='{process_date}' ) tc inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where  process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)cs on tc.cin=cs.cin"
        },
        "TEST_CASE_11":{
            "description":"Validate short qty for the identified invoice is due to increased demand of a secondary item When searching for any specific Process date Then total number of invoices in RCA6 showing 'Secondary Item Demand' matches the count of invoices where there is an increase in demand for secondary item",
            "type":"RCA",
            "sql_query":["select * from (SELECT  process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,LF_CARD_GEN_SEQ_NUM,inv_purchasing_supplier,lf_ship_to_location_num,lf_shrt_id,lf_short_code,CF_GCN_Disruption_Forecast,CF_GCN_Total_Forecast,CF_Sum_7days_Order_Qty_CIN_DC,LF_Inv_Deviation_Percentage,LF_Inv_DemandForecast_Forecasting_Period,CF_Secondary_Item_Demand_RCA FROM `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date='{process_date}' and (CF_GCN_Disruption_Forecast/case when CF_GCN_Total_Forecast>0 then cf_gcn_total_forecast else null end)>0.2 and CF_Sum_7days_Order_Qty_CIN_DC>=(((ifnull(LF_Inv_Deviation_Percentage,0)/100)*LF_Inv_DemandForecast_Forecasting_Period)+LF_Inv_DemandForecast_Forecasting_Period) and  ifnull(lf_short_code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(lf_vbap_shrt_id,'') not in ('ZD','Z8') and ifnull(Inv_Activity_Class_Code ,'') in ('A','M','R','U','W') and ifnull(lf_aa_code,'') in ('982', '950', '998', '990', '995', '912','') and CF_COUNT_CIN_GSN > 1 and  ifnull(DUPLICATEMATERIAL,'') in ('','NO'))a full outer join (select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,LF_CARD_GEN_SEQ_NUM,inv_purchasing_supplier,lf_ship_to_location_num,lf_shrt_id,lf_short_code,CF_GCN_Disruption_Forecast,CF_GCN_Total_Forecast,CF_Sum_7days_Order_Qty_CIN_DC,LF_Inv_Deviation_Percentage,LF_Inv_DemandForecast_Forecasting_Period,CF_Secondary_Item_Demand_RCA FROM `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}')b on a.invoice_number=b.invoice_number and a.invoice_line_number=b.invoice_line_number"],
            "top_75":"SELECT distinct rca.*,top.CF_CIN_Short_Qty FROM ( select process_date,invoice_date,cin,dc,invoice_number,invoice_line_number,inv_purchasing_supplier,lf_ship_to_location_num,CF_GCN_Disruption_Forecast,CF_GCN_Total_Forecast,CF_Sum_7days_Order_Qty_CIN_DC,LF_Inv_Deviation_Percentage,LF_Inv_DemandForecast_Forecasting_Period,lf_aa_code FROM `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') rca inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)top on rca.cin=top.cin"
                    },
        "TEST_CASE_12":{
            "description":"Validate the A-Class status for RCA 6 When validate A-Class status for any given process date Then Inv_Activity_Class_Code is in (A,M,R,U,W)",
            "type":"RCA",
            "sql_query":["select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, Inv_Activity_Class_Code from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL`  where Inv_Activity_Class_Code not in ('A','M','R','U','W') and Process_Date='{process_date}'"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, Inv_Activity_Class_Code from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL`  where ifnull(Inv_Activity_Class_Code,'') in ('A','M','R','U','W') and Process_Date='{process_date}')  kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_13":{
            "description":"Validate whether there is any material which doesnt have any other materials under the same gsn in RCA 6 When validate GSN of the CINS in RCA 6 Then All CINS should have more than one CIN within the GSN in order to qualify as Secondary Demand",
            "type":"RCA",
            "sql_query":["with subq as (select Process_Date,Invoice_Date,CIN,DC,LF_Card_Gen_Seq_Num,Invoice_Number,INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}')  Select distinct * from subq a left join  (Select LF_Card_Gen_Seq_Num, count( *) count_cin from ((Select distinct LF_Card_Gen_Seq_Num from subq) left outer join (select distinct safe_cast(mtrl_num as int64) matnr,ifnull(safe_cast(CAH_GCN_SEQ_NO as int),0) card_gen_seq_num from `edna-data-pr-cah.VW_PHM_SC_DIMENSION_NP.VW_ORP_MATERIAL` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(`MTRL_CRCTRSTC-DUPLICATEMATERIAL`,'')<>'PUERTO-RICO' and ifnull(FLG_MTRL_FOR_DEL_AT_CLIENT_LEVEL,'')<>'X' and (ifnull(`MTRL_CRCTRSTC-PUERTORICO`,'')='' or `MTRL_CRCTRSTC-PUERTORICO`='NO') ) on LF_Card_Gen_Seq_Num=card_gen_seq_num) group by  LF_Card_Gen_Seq_Num  ) b on a.LF_Card_Gen_Seq_Num=b.LF_Card_Gen_Seq_Num where b.count_cin<=1"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, LF_Card_Gen_Seq_Num from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL`  where  Process_Date='{process_date}')  kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_14":{
            "description":"Validate whether CF_COUNT_CIN_GSN is calculated correctly When validate GSN of the CINS for any process_date Then CF_COUNT_CIN_GSN should match the count of CINs within the GSN",
            "type":"RCA",
            "sql_query":["with subq as (select Process_Date,Invoice_Date,CIN,DC,LF_Card_Gen_Seq_Num,Invoice_Number,INVOICE_LINE_NUMBER,CF_COUNT_CIN_GSN from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') Select distinct a.*,ifnull(COUNT_CIN_GSN,0) COUNT_CIN_GSN, (ifnull(CF_COUNT_CIN_GSN,0)<>ifnull(COUNT_CIN_GSN,0)) CountGSNVal from subq a left join  (Select LF_Card_Gen_Seq_Num,card_gen_seq_num, count( *) COUNT_CIN_GSN from ((Select distinct LF_Card_Gen_Seq_Num from subq) left outer join (select distinct safe_cast(mtrl_num as int64) matnr,ifnull(safe_cast(CAH_GCN_SEQ_NO as int),0) card_gen_seq_num from `edna-data-pr-cah.VW_PHM_SC_DIMENSION_NP.VW_ORP_MATERIAL` where  ifnull(`MTRL_CRCTRSTC-DUPLICATEMATERIAL`,'')<>'PUERTO-RICO' and ifnull(FLG_MTRL_FOR_DEL_AT_CLIENT_LEVEL,'')<>'X' and (ifnull(`MTRL_CRCTRSTC-PUERTORICO`,'')='' or `MTRL_CRCTRSTC-PUERTORICO`='NO') and ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 ) on LF_Card_Gen_Seq_Num=card_gen_seq_num) group by  LF_Card_Gen_Seq_Num,card_gen_seq_num  having card_gen_seq_num is not null) b on a.LF_Card_Gen_Seq_Num=b.LF_Card_Gen_Seq_Num where COUNT_CIN_GSN<>CF_COUNT_CIN_GSN"],
            "top_75":"SELECT distinct kcd.*,sh.CF_CIN_Short_Qty FROM (select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC, LF_Card_Gen_Seq_Num,CF_COUNT_CIN_GSN from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL`  where  Process_Date='{process_date}')  kcd inner join (select distinct CIN,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75) sh on kcd.CIN=sh.CIN  order by CF_CIN_Short_Qty desc"
        },
        "TEST_CASE_15":{
            "description":"All cin in the table should have DUPLICATEMATERIAL as not SEQUESTERED When searched for a cin Then the value of DUPLICATEMATERIAL should match with the source Material Master Model And DUPLICATEMATERIAL should not be SEQUESTERED",
            "type":"RCA",
            "sql_query":["Select * from ((Select distinct Process_Date,Invoice_Date,CIN,DC,LF_Card_Gen_Seq_Num,Invoice_Number,INVOICE_LINE_NUMBER,DUPLICATEMATERIAL from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}') left outer join (select distinct safe_cast(mtrl_num as int64) matnr,ifnull(`MTRL_CRCTRSTC-DUPLICATEMATERIAL`,'') DUPLICATEMATERIAL_Calc from `edna-data-pr-cah.VW_PHM_SC_DIMENSION_NP.VW_ORP_MATERIAL` where ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334)b on  matnr=cin)   where ifnull(DUPLICATEMATERIAL_Calc,'')<>ifnull(DUPLICATEMATERIAL,'')",
            "Select  Process_Date,Invoice_Date,CIN,DC,LF_Card_Gen_Seq_Num,Invoice_Number,INVOICE_LINE_NUMBER,DUPLICATEMATERIAL from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where process_date='{process_date}' and not((ifnull(DUPLICATEMATERIAL,'')='' or ifnull(DUPLICATEMATERIAL,'')='NO'))"],
            "top_75":"select distinct tc.*,cs.CF_CIN_Short_Qty from (select process_date,invoice_date,cin,dc,DUPLICATEMATERIAL from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where  process_date='{process_date}' ) tc inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where  process_date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)cs on tc.cin=cs.cin"
                },
            "TEST_CASE_16":{
            "description":"Validate the ORDER_CREATE_DTE, Sum_Order_Qty_DC and SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY of orders in RCA 6 When validate invoices for any given process date Then ORDER_CREATE_DTE, Sum_Order_Qty_DC and SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY should match the data from source",
            "type":"RCA",
            "sql_query":["Select dp.*,ORDER_DTE_BM  from ((Select Invoice_Date,LF_CUSTOMER_ORDER_DATE,SAP_SHIP_TO_CUSTOMER_NUMBER,CIN,LF_Ship_To_Location_Num,Invoice_Number,INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where Process_Date='{process_date}')dp left outer join  (Select  BILL_DTE,ORDER_DOC_DTE ORDER_DTE_BM,safe_cast(SHIP_TO_ACCT as int) SHIP_TO_ACCT,MTRL_NUM,safe_cast(trim(PLANT,'P') as int) PLANT,BILL_TYPE,safe_cast(BILL_DOC as int) BILL_DOC,safe_cast(BILL_ITEM as int) BILL_ITEM  from `edna-data-pr-cah.VW_PHM_SC_LOGICAL_VIEWS_NP.VW_CUSTOMER_BILLING` where  ifnull(safe_cast(SUPPLIER_NUM as int),0)<>57334 and ifnull(shrt_cde,'') not in ('BR', 'BC', '04')  and BILL_TYPE='ZP40'  and SALE_ORG='2220'  and DIST_CHNL='10'  and HDR_DIV in ('10','20','30')  and RTRN_REASON='' and PLANT NOT IN ('P095', 'B099', 'B019') and bill_dte in (date('{process_date}')-1,date('{process_date}'))) ON Invoice_Number=safe_cast(BILL_DOC as int)  and INVOICE_LINE_NUMBER=safe_cast(BILL_ITEM as int)) where (LF_CUSTOMER_ORDER_DATE<>ORDER_DTE_BM)",
            "select Process_Date, Invoice_Date, Invoice_Number, INVOICE_LINE_NUMBER, CIN, DC,CF_Sum_Order_Qty_DC, round(sum(ifnull(sumqty,0)),2) as Sum_Order_Qty_DC,count(ifnull(sumqty,1)) as countqty from  (Select kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,Invoice_Number, INVOICE_LINE_NUMBER,kcd.CF_Sum_Order_Qty_DC, sum(ifnull(order_qty,0)) as sumqty from (select distinct Invoice_Date,Process_Date,CIN,DC,CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where Process_Date='{process_date}') kcd left outer join (select distinct rfrnc_dte_invoice,corp_item_num,ship_to_location_num,ORDER_QTY, Invoice_Num, INVOICE_LINE_NUM,ORDER_DTE from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where invoice_type ='ZP40' and ifnull(short_code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and rfrnc_dte_invoice between date('{process_date}')-114 and date('{process_date}'))  hd on hd.rfrnc_dte_invoice=kcd.Invoice_Date  AND hd.order_qty > 0 and hd.order_dte  between kcd.Invoice_Date -113  and kcd.Invoice_Date  and hd.corp_item_num=kcd.CIN and hd.SHIP_TO_LOCATION_NUM=kcd.DC group by kcd.Invoice_Date,kcd.Process_Date,kcd.CIN,kcd.DC,kcd.CF_Sum_Order_Qty_DC,Invoice_Number, INVOICE_LINE_NUMBER)  group by Process_Date,Invoice_Date,CIN,DC,Invoice_Number, INVOICE_LINE_NUMBER, CF_Sum_Order_Qty_DC having ifnull(CF_Sum_Order_Qty_DC,0)<>ifnull(Sum_Order_Qty_DC,0)",
            "with pd1 as (select max(process_date) max_pd from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date='{process_date}'),  pd2 as (select max(process_date) min_pd from `{project_name}.{dataset_id}.DATAPOINT_UNFILL_INVOICE_CDL` where process_date<(select max_pd from pd1)),  pd3 as (Select max(D0_UPDATE_STP)  max_tmp from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL`)  Select  dp.*,cis1.SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY from (Select Process_Date,Invoice_Date,CIN,DC,Invoice_Number,INVOICE_LINE_NUMBER,SAP_SHIP_TO_CUSTOMER_NUMBER,CF_SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY  from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL`  where Process_Date='{process_date}' ) dp  LEFT OUTER JOIN   (Select corp_item_num,invoice_num,invoice_line_num,SAP_SHIP_TO_CUSTOMER_NUM,rfrnc_dte_invoice,sum(Short_Qty) AS SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY from `{project_name}.{dataset_id}.CUSTOMER_INVOICE_CDL` where SHORT_QTY>0 and ifnull(short_code,'') not in ('BR', 'BC', '04', '01', 'IO') and ifnull(VBAP_SHRT_ID,'') not in ('ZD','Z8') and ((d0_update_stp>(select min_pd from pd2) and d0_update_stp<=(select max_pd from pd1)) or  ((d0_update_stp<=(select min_pd from pd2) or d0_update_stp>(select max_pd from pd1)) and (rfrnc_dte_invoice between date('{process_date}')-1 and date('{process_date}'))  and concat(Invoice_Num,'-',INVOICE_LINE_NUM) not in (select concat(invoice_number,'-',INVOICE_LINE_NUMBER) from `{project_name}.{dataset_id}.RCA_UNFILL_ALL_DATA_ANALYSIS_CDL` where date(process_date)=(select date(min_pd) from pd2) and process_date<=(select min_pd from pd2) )))  group by corp_item_num,SAP_SHIP_TO_CUSTOMER_NUM,rfrnc_dte_invoice,invoice_num,INVOICE_LINE_NUM) cis1  ON cis1.corp_item_num=CIN  and cis1.rfrnc_dte_invoice=Invoice_Date and cis1.SAP_SHIP_TO_CUSTOMER_NUM=SAP_SHIP_TO_CUSTOMER_NUMBER and invoice_num=invoice_number and invoice_line_num=invoice_line_number where ifnull(CF_SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY,0)<>ifnull(SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY,0)"],
            "top_75":"select distinct kcd.*,sh.CF_CIN_Short_Qty FROM (Select Process_Date,Invoice_Date,CIN,LF_Ship_to_Location_Num,DC,Invoice_Number,INVOICE_LINE_NUMBER,LF_CUSTOMER_ORDER_DATE,CF_Sum_Order_Qty_DC,CF_SAP_SHIP_TO_CUSTOMER_CIN_SHORT_QTY FROM `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where Process_Date='{process_date}' order by Invoice_Number,Invoice_Line_Number) kcd inner join (select distinct cin,CF_CIN_Short_Qty from `{project_name}.{dataset_id}.RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL` where Process_Date='{process_date}' order by CF_CIN_Short_Qty desc limit 75)sh on kcd.CIN=sh.CIN order by CF_CIN_Short_Qty desc"
        }    
    
    },
    "project_id": "edr-phm-ai-im-pr-cah",
	"project_name":"edr-phm-ai-im-pr-cah",
    "dataset_id": "UNFILLED_UNITS_DEV",
    "key":"edr-phm-ai-im-pr-cah-fe45d3ea1bae.json",
    "table_id": "RCA_UNFILL_SECONDARY_ITEM_DEMAND_CDL",
	"alphabet_check_column_name": [],
    "alphanumeric_check_column_name": [],
    "length_check_column_name": [],
    "null_check_column_name": [],
    "numeric_check_column_name": []
}